(function(){template.compile('/* gM.log(data); gM.log(config); var quiz=data[\'quiz\']; var quizId=data[\'quizId\']; var nodeId=quiz[\'nodeId\']; var baseType=quiz[\'baseType\']; var quizTypeId=quiz[\'quizTypeId\']; var submit=data[\'submit\']||{}; var submitId=submit[\'submitId\']||""; var standardAndRecord=data[\'standardAndRecord\']||[]; var review=data[\'review\']||{}; var reviewId=review[\'reviewId\']||{}; var showStart=config.start||1; var showIndex=showStart+config.index; var divId=config[\'divId\']; var divClass= config[\'divClass\']||""; var nodePath= quiz[\'nodePath\']||""; var nodePathId= quiz[\'nodePathId\']||""; var errorFlag=submit[\'errorFlag\']||""; */ <div class="view-test /*=divClass*/" id="/*=divId*/" node_id=/*=nodeId*/ base_type="/*=baseType*/" quiz_id="/*=quizId*/" quiz_score="/*=quiz[\'quizScore\']*/" submit_id="/*=submitId*/" review_id="/*=reviewId*/" error_flag="/*=errorFlag*/"> <span class="prev-option"> <a href="javascript:void(0)" class="input-c selected" _type="sel_quiz"></a> </span> /*if(config.icon){ var icnStr=config.icon; if (icnStr.indexOf("{quizId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{quizId}\', \'g\'), quizId); } if (icnStr.indexOf("{submitId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{submitId}\', \'g\'), submitId); } if (icnStr.indexOf("{nodeId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{nodeId}\', \'g\'), nodeId); } */ <span class="prev-option">/*=icnStr*/</span> /*}*/ /*if(config.autoReview){*/ <span class="prev-option" style="display: none" _type="error-mark"> <i class="icon-mark error-mark"></i> </span> <span class="prev-option" style="display: none" _type="right-mark"> <i class="icon-mark right-mark"></i> </span> /*}*/ /*if(quizTypeId == "itt003_mc"){*/ <div class="test-title clearfix"> <span class="test-no">/*=showIndex*/</span> <div class="test-additional-tutami">/*=quiz["additional"]*/</div> <div class="test-header"> /*if(config.practice){*/ /*if(quizTypeId == "itt003"){*/ [/*=Msg.get(\'quiz.itt003\');*/] /*}else if(quizTypeId == "itt004"){*/ [/*=Msg.get(\'quiz.itt004\');*/] /*}*/ /*}*/ /* var quizContent = quiz[\'quizContent\'].replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); quizContent = quizContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="test-text-tutami"> /*=gM.jsEnter(quizContent)*/ </div> /*include(\'quiz_option\',{baseType:baseType,options:quiz[\'quizOptionses\'],submit:submit,config:config});*/ </div> /*if(config.toggleTitle){*/ <p> <a href="javascript:void(0)" class="action-more" _type="toggleTitle">\u663e\u793a\u95ee\u9898\u63cf\u8ff0<i class="icon-arrow01"></i> </a> </p> /*}*/ </div> /*}else{*/ <div class="test-title clearfix"> <span class="test-no">/*=showIndex*/</span> <div class="test-header"> /*if(config.practice){*/ /*if(quizTypeId == "itt003"){*/ [/*=Msg.get(\'quiz.itt003\');*/] /*}else if(quizTypeId == "itt004"){*/ [/*=Msg.get(\'quiz.itt004\');*/] /*}*/ /*}*/ /* var quizContent = quiz[\'quizContent\'].replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); quizContent = quizContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="test-text-tutami"> /*=gM.jsEnter(quizContent)*/ </div> <div class="test-attach"> /* include(\'quiz_attr\',{nodeAttr:quiz[\'nodeAttr\'],download:true,delFlag:false,attrFlag:0}); */ </div> </div> /*if(config.toggleTitle){*/ <p> <a href="javascript:void(0)" class="action-more" _type="toggleTitle">\u663e\u793a\u95ee\u9898\u63cf\u8ff0<i class="icon-arrow01"></i> </a> </p> /*}*/ </div> /* include(\'quiz_option\',{baseType:baseType,options:quiz[\'quizOptionses\'],submit:submit,config:config}); }*/ /* include(\'mark-standard\',{standardAndRecord:standardAndRecord,config:config}); if("itt002,itt003,itt004".indexOf(baseType)==-1){ include(\'quiz_user_ana\',{submit:submit,config:config}); } include(\'quiz_ana\',{responses:quiz[\'quizResponses\'],solutions:quiz[\'quizSolutions\'],options:quiz[\'quizOptionses\'],config:config}); include(\'quiz_mark\',{standardAndRecord:standardAndRecord,review:review,config:config}); include(\'quiz_comment\',{review:review,config:config}); */ <p class="test-result test-right" style="display: none" _type="right-mark">/*=Msg.get(\'exam.tips.response.right\')*/</p> <p class="test-result test-error" style="display: none" _type="error-mark">/*=Msg.get(\'exam.tips.response.error\')*/</p> <p class="test-result test-rfix" style="display: none" _type="quizError-mark">\u8be5\u9898\u5df2\u88ab\u7ea0\u9519\u8c03\u6574\uff0c\u6309\u7b54\u5bf9\u5f97\u5206\uff01</p> /*if(config.standard){*/ <div class="test-form" _type="edit_standard"> /* include(\'quiz_comment_add\',{standardAndRecord:standardAndRecord,index:1,config:config}); */ /*if(!config.controlEditModel){*/ <div class="form-action"> <a class="btn-new btn_add_option" href="javascript:void(0)"><i class="icon-new"></i>/*=Msg.get(\'exam.add.standard\')*/</a> </div> /*}*/ </div> /*}*/ /*if(config.libEdit||config.libView){ var viewPath=pathUtil.parse(nodePath,null,2); var canDelPath=true; if(viewPath.length==0){ viewPath="\u6839\u76ee\u5f55"; canDelPath=false; } */ <div class="test-directory"> <span class="tdt-text">\u6240\u5728\u76ee\u5f55\uff1a</span> <span class="directory-text substr">/*=viewPath*/</span> /*if(canDelPath&&config.libEdit){*/ <i class="icon-remove" _type="delLib" node_id="/*=nodeId*/"></i> /*}*/ </div> /*}*/ /*if(config.practice && \'|itt003|itt002|itt004|\'.indexOf(baseType)>-1 ){*/ <div class="view-shadow"></div> /*}*/ <div class="test-points clearfix"> /*if(false){*/ <span class="point-text">/*=Msg.get(\'exam.quiz.knowledge\')*/</span> <span class="point-item">\u8fa9\u8bc1\u552f\u7269\u89c2</span> <span class="point-item">\u4e2d\u56fd\u4f20\u7edf\u6587\u5316</span> /*}*/ /*if(config.groupOpt1){*/ <div class="link-group"> /*if(config.quizEdit){*/ <a class="link-action" href="javascript:void(0)" _type="edit"><i class="i-edit"></i><b>/*=Msg.get(\'exam.edit\')*/</b></a> /*}*/ /*if(config.quizDel){*/ <a class="link-action" href="javascript:void(0)" _type="del"><i class="icon-del01"></i><b>/*=Msg.get(\'exam.delete\')*/</b></a> /*}*/ </div> /*}*/ </div> </div>',{filename:"quiz_cart"});template.compile('/* gM.log(data); gM.log(config); var quiz=data[\'quiz\']; var quizId=data[\'quizId\']; var nodeId=quiz[\'nodeId\']; var baseType=quiz[\'baseType\']; var quizTypeId=quiz[\'quizTypeId\']; var submit=data[\'submit\']||{}; var submitId=submit[\'submitId\']||""; var standardAndRecord=data[\'standardAndRecord\']||[]; var review=data[\'review\']||{}; var reviewId=review[\'reviewId\']||{}; var showStart=config.start||1; var showIndex=showStart+config.index; var divId=config[\'divId\']; var divClass= config[\'divClass\']||""; var nodePath= quiz[\'nodePath\']||""; var nodePathId= quiz[\'nodePathId\']||""; var errorFlag=submit[\'errorFlag\']||""; var quizDifficult=quiz[\'quizDifficult\']; */ <div class="view-test /*=divClass*/" id="/*=divId*/" node_id=/*=nodeId*/ base_type="/*=baseType*/" quiz_id="/*=quizId*/" quiz_score="/*=quiz[\'quizScore\']*/" submit_id="/*=submitId*/" review_id="/*=reviewId*/" error_flag="/*=errorFlag*/"> /*if(config.icon){ var icnStr=config.icon; if (icnStr.indexOf("{quizId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{quizId}\', \'g\'), quizId); } if (icnStr.indexOf("{submitId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{submitId}\', \'g\'), submitId); } if (icnStr.indexOf("{nodeId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{nodeId}\', \'g\'), nodeId); } */ <span class="prev-option">/*=icnStr*/</span> /*}*/ /*if(config.autoReview){*/ <span class="prev-option" style="display: none" _type="error-mark"> <i class="icon-mark error-mark"></i> </span> <span class="prev-option" style="display: none" _type="right-mark"> <i class="icon-mark right-mark"></i> </span> /*}*/ <div class="test-title clearfix"> <span class="test-no">/*=showIndex*/</span> <div class="test-header"> /*if(config.practice){*/ /*if(quizTypeId == "itt003"){*/ [/*=Msg.get(\'quiz.itt003\');*/] /*}else if(quizTypeId == "itt004"){*/ [/*=Msg.get(\'quiz.itt004\');*/] /*}*/ /*}*/ /* var quizContent = quiz[\'quizContent\'].replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); quizContent = quizContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="test-text-tutami"> /*=gM.jsEnter(quizContent)*/ </div> <div class="test-attach"> /* include(\'quiz_attr_node\',{baseType:baseType,nodeAttr:quiz[\'nodeAttr\'],download:true,delFlag:false,attrFlag:0}); */ </div> /*if(quizTypeId == "itt003_mc"){*/ <div class="test-additional"> /*=quiz["additional"]*/ </div> /*}*/ </div> /*if(config.toggleTitle){*/ <p> <a href="javascript:void(0)" class="action-more" _type="toggleTitle">\u663e\u793a\u95ee\u9898\u63cf\u8ff0<i class="icon-arrow01"></i> </a> </p> /*}*/ </div> /* include(\'quiz_option\',{baseType:baseType,options:quiz[\'quizOptionses\'],submit:submit,config:config}); include(\'mark-standard\',{standardAndRecord:standardAndRecord,config:config}); if("itt002,itt003,itt004".indexOf(baseType)==-1){ include(\'quiz_user_ana\',{submit:submit,config:config}); } include(\'quiz_ana\',{responses:quiz[\'quizResponses\'],solutions:quiz[\'quizSolutions\'],options:quiz[\'quizOptionses\'],config:config}); include(\'quiz_mark\',{standardAndRecord:standardAndRecord,review:review,config:config}); include(\'quiz_comment\',{review:review,config:config}); */ <p class="test-result test-right" style="display: none" _type="right-mark">/*=Msg.get(\'exam.tips.response.right\')*/</p> <p class="test-result test-error" style="display: none" _type="error-mark">/*=Msg.get(\'exam.tips.response.error\')*/</p> <p class="test-result test-rfix" style="display: none" _type="quizError-mark">\u8be5\u9898\u5df2\u88ab\u7ea0\u9519\u8c03\u6574\uff0c\u6309\u7b54\u5bf9\u5f97\u5206\uff01</p> /*if(config.standard){*/ <div class="test-form" _type="edit_standard"> /* include(\'quiz_comment_add\',{standardAndRecord:standardAndRecord,index:1,config:config}); */ /*if(!config.controlEditModel){*/ <div class="form-action"> <a class="btn-new btn_add_option" href="javascript:void(0)"><i class="icon-new"></i>/*=Msg.get(\'exam.add.standard\')*/</a> </div> /*}*/ </div> /*}*/ /*if(config.showDifficult){*/ <div class="test-directory"> <span class="tdt-text">\u96be&nbsp;\u6613&nbsp;\u5ea6\uff1a</span> <span class="directory-text substr"> /*if(quizDifficult == 0){ */ \u96be /*}else if(quizDifficult == 100){ */ \u6613 /*}else if(0<quizDifficult&&quizDifficult<50){ */ \u8f83\u96be /*}else if(50<quizDifficult&&quizDifficult< 100){ */ \u8f83\u6613 /*}else { */ \u4e2d /*} */ </span> </div> /*}*/ /*if(config.libEdit||config.libView){ var viewPath=pathUtil.parse(nodePath,null,2); var canDelPath=true; if(viewPath.length==0){ viewPath="\u6839\u76ee\u5f55"; canDelPath=false; } */ <div class="test-directory"> <span class="tdt-text">\u6240\u5728\u76ee\u5f55\uff1a</span> <span class="directory-text substr">/*=viewPath*/</span> /*if(canDelPath&&config.libEdit){*/ <i class="icon-remove" _type="delLib" node_id="/*=nodeId*/"></i> /*}*/ </div> /*}*/ /*if(config.practice && \'|itt003|itt002|itt004|\'.indexOf(baseType)>-1 ){*/ <div class="view-shadow"></div> /*}*/ <div class="test-points clearfix"> /*if(false){*/ <span class="point-text">/*=Msg.get(\'exam.quiz.knowledge\')*/</span> <span class="point-item">\u8fa9\u8bc1\u552f\u7269\u89c2</span> <span class="point-item">\u4e2d\u56fd\u4f20\u7edf\u6587\u5316</span> /*}*/ /*if(config.groupOpt1){*/ <div class="link-group">/*if(config.changePath){*/<a class="link-action" href="javascript:void(0)" _type="changePath"><i class="i-count"></i><b>切换目录</b></a>/*}*/ /*if(config.quizEdit){*/ <a class="link-action" href="javascript:void(0)" _type="edit"><i class="i-edit"></i><b>/*=Msg.get(\'exam.edit\')*/</b></a> /*}*/ /*if(config.quizDel){*/ <a class="link-action" href="javascript:void(0)" _type="del"><i class="icon-del01"></i><b>/*=Msg.get(\'exam.delete\')*/</b></a> /*}*/ </div> /*}*/ </div> </div>',{filename:"quiz_layout"});template.compile('/* gM.log(data); gM.log(config); var courseOpenId=courseOpenId; var quiz=data[\'quiz\']; var quizId=data[\'quizId\']; var nodeId=quiz[\'nodeId\']; var baseType=quiz[\'baseType\']; var quizTypeId=quiz[\'quizTypeId\']; var submit=data[\'submit\']||{}; var submitId=submit[\'submitId\']||""; var standardAndRecord=data[\'standardAndRecord\']||[]; var review=data[\'review\']||{}; var reviewId=review[\'reviewId\']||{}; var showStart=config.start||1; var showIndex=showStart+config.index; var divId=config[\'divId\']; var divClass= config[\'divClass\']||""; var nodePath= quiz[\'nodePath\']||""; var nodePathId= quiz[\'nodePathId\']||""; var errorFlag=submit[\'errorFlag\']||""; var quizDifficult=quiz[\'quizDifficult\']; */ <div class="view-test /*=divClass*/" id="/*=divId*/" node_id=/*=nodeId*/ base_type="/*=baseType*/" quiz_id="/*=quizId*/" quiz_score="/*=quiz[\'quizScore\']*/" submit_id="/*=submitId*/" review_id="/*=reviewId*/" error_flag="/*=errorFlag*/"> /*if(config.icon){ var icnStr=config.icon; if (icnStr.indexOf("{quizId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{quizId}\', \'g\'), quizId); } if (icnStr.indexOf("{submitId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{submitId}\', \'g\'), submitId); } if (icnStr.indexOf("{nodeId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{nodeId}\', \'g\'), nodeId); } */ <span class="prev-option">/*=icnStr*/</span> /*}*/ /*if(config.autoReview){*/ <span class="prev-option" style="display: none" _type="error-mark"> <i class="icon-mark error-mark"></i> </span> <span class="prev-option" style="display: none" _type="right-mark"> <i class="icon-mark right-mark"></i> </span> /*}*/ <div class="test-title clearfix"> <span class="test-no">/*=showIndex*/</span> <div class="test-header"> /*if(config.practice){*/ /*if(quizTypeId == "itt003"){*/ [/*=Msg.get(\'quiz.itt003\');*/] /*}else if(quizTypeId == "itt004"){*/ [/*=Msg.get(\'quiz.itt004\');*/] /*}*/ /*}*/ /* var quizContent = quiz[\'quizContent\'].replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); quizContent = quizContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="test-text-tutami"> /*=gM.jsEnter(quizContent)*/ </div> <div class="test-attach"> /* include(\'quiz_attr\',{baseType:baseType,courseOpenId:courseOpenId,nodeAttr:quiz[\'nodeAttr\'],download:true,delFlag:false,attrFlag:0}); */ </div> /*if(quizTypeId == "itt003_mc"){*/ <div class="test-additional"> /*=quiz["additional"]*/ </div> /*}*/ </div> /*if(config.toggleTitle){*/ <p> <a href="javascript:void(0)" class="action-more" _type="toggleTitle">\u663e\u793a\u95ee\u9898\u63cf\u8ff0<i class="icon-arrow01"></i> </a> </p> /*}*/ </div> /* include(\'quiz_option\',{baseType:baseType,options:quiz[\'quizOptionses\'],submit:submit,config:config}); include(\'mark-standard\',{standardAndRecord:standardAndRecord,config:config}); if("itt002,itt003,itt004".indexOf(baseType)==-1){ include(\'quiz_user_ana\',{baseType:baseType,courseOpenId:courseOpenId,submit:submit,config:config}); } include(\'quiz_ana\',{responses:quiz[\'quizResponses\'],solutions:quiz[\'quizSolutions\'],options:quiz[\'quizOptionses\'],config:config}); include(\'quiz_mark\',{standardAndRecord:standardAndRecord,review:review,config:config}); include(\'quiz_comment\',{review:review,config:config}); */ <p class="test-result test-right" style="display: none" _type="right-mark">/*=Msg.get(\'exam.tips.response.right\')*/</p> <p class="test-result test-error" style="display: none" _type="error-mark">/*=Msg.get(\'exam.tips.response.error\')*/</p> <p class="test-result test-rfix" style="display: none" _type="quizError-mark">\u8be5\u9898\u5df2\u88ab\u7ea0\u9519\u8c03\u6574\uff0c\u6309\u7b54\u5bf9\u5f97\u5206\uff01</p> /*if(config.standard){*/ <div class="test-form" _type="edit_standard"> /* include(\'quiz_comment_add\',{standardAndRecord:standardAndRecord,index:1,config:config}); */ /*if(!config.controlEditModel){*/ <div class="form-action"> <a class="btn-new btn_add_option" href="javascript:void(0)"><i class="icon-new"></i>/*=Msg.get(\'exam.add.standard\')*/</a> </div> /*}*/ </div> /*}*/ /*if(config.showDifficult){*/ <div class="test-directory"> <span class="tdt-text">\u96be&nbsp;\u6613&nbsp;\u5ea6\uff1a</span> <span class="directory-text substr"> /*if(quizDifficult == 0){ */ \u96be /*}else if(quizDifficult == 100){ */ \u6613 /*}else if(0<quizDifficult&&quizDifficult<50){ */ \u8f83\u96be /*}else if(50<quizDifficult&&quizDifficult< 100){ */ \u8f83\u6613 /*}else { */ \u4e2d /*} */ </span> </div> /*}*/ /*if(config.libEdit||config.libView){ var viewPath=pathUtil.parse(nodePath,null,2); var canDelPath=true; if(viewPath.length==0){ viewPath="\u6839\u76ee\u5f55"; canDelPath=false; } */ <div class="test-directory"> <span class="tdt-text">\u6240\u5728\u76ee\u5f55\uff1a</span> <span class="directory-text substr">/*=viewPath*/</span> /*if(canDelPath&&config.libEdit){*/ <i class="icon-remove" _type="delLib" node_id="/*=nodeId*/"></i> /*}*/ </div> /*}*/ /*if(config.practice && \'|itt003|itt002|itt004|\'.indexOf(baseType)>-1 ){*/ <div class="view-shadow"></div> /*}*/ <div class="test-points clearfix"> /*if(false){*/ <span class="point-text">/*=Msg.get(\'exam.quiz.knowledge\')*/</span> <span class="point-item">\u8fa9\u8bc1\u552f\u7269\u89c2</span> <span class="point-item">\u4e2d\u56fd\u4f20\u7edf\u6587\u5316</span> /*}*/ /*if(config.groupOpt1){*/ <div class="link-group"> /*if(config.quizEdit){*/ <a class="link-action" href="javascript:void(0)" _type="edit"><i class="i-edit"></i><b>/*=Msg.get(\'exam.edit\')*/</b></a> /*}*/ /*if(config.quizDel){*/ <a class="link-action" href="javascript:void(0)" _type="del"><i class="icon-del01"></i><b>/*=Msg.get(\'exam.delete\')*/</b></a> /*}*/ </div> /*}*/ </div> </div>',{filename:"quiz_layout_courseOpenId"});template.compile('/*if(ArrUtil.isArray(options)&&options.length>0){*/ <div class="test-options"> /* var check_class="input-c"; if(baseType!="itt004"){ check_class="input-r"; } var userAnswer=submit[\'userAnswer\']||""; var uA=userAnswer.split(",")||[]; for(var i=0; i< options.length;i++){ var option=options[i]; var optionId=option[\'optionId\']; var selectClass=""; if((config.userAnswer||config.practice)&&ArrUtil.contains(uA,optionId)){ selectClass="selected"; } var optionContent = option.optionContent.replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); optionContent = optionContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="t-option" option_id="/*=optionId*/"> <span class="opt-prev"> <a href="javascript:void(0)" class="/*=check_class*/ /*=selectClass*/" _type="practice"></a> /*=String.fromCharCode("A".charCodeAt()+i) */\u3001 </span> <p>/*=optionContent*/</p> </div> /*}*/ </div> /*}*/',{filename:"quiz_option"});template.compile('/* gM.log(data); gM.log(config); var quiz=data[\'quiz\']; var quizId=data[\'quizId\']; var nodeId=quiz[\'nodeId\']; var baseType=quiz[\'baseType\']; var quizTypeId=quiz[\'quizTypeId\']; var submit=data[\'submit\']||{}; var submitId=submit[\'submitId\']||""; var standardAndRecord=data[\'standardAndRecord\']||[]; var review=data[\'review\']||{}; var reviewId=review[\'reviewId\']||{}; var showStart=config.start||1; var showIndex=showStart+config.index; var divId=config[\'divId\']; var divClass= config[\'divClass\']||""; var nodePath= quiz[\'nodePath\']||""; var nodePathId= quiz[\'nodePathId\']||""; var errorFlag=submit[\'errorFlag\']||""; var quizDifficult=quiz[\'quizDifficult\']; */ <div id="/*=divId*/" node_id=/*=nodeId*/ base_type="/*=baseType*/" quiz_id="/*=quizId*/" quiz_score="/*=quiz[\'quizScore\']*/" submit_id="/*=submitId*/" review_id="/*=reviewId*/" error_flag="/*=errorFlag*/"> /*if(config.icon){ var icnStr=config.icon; if (icnStr.indexOf("{quizId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{quizId}\', \'g\'), quizId); } if (icnStr.indexOf("{submitId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{submitId}\', \'g\'), submitId); } if (icnStr.indexOf("{nodeId}") > -1) { icnStr = icnStr.replace(new RegExp(\'{nodeId}\', \'g\'), nodeId); } */ <span class="prev-option">/*=icnStr*/</span> /*}*/ /*if(quiz["additional"]==\'\'){*/ <div class="view-test not-article"> /*}else{*/ <div class="view-test"> /*}*/ /*if(quiz["additional"]!=\'\'){*/ <div class="test-article"> <div class="quiz-passages"> /*=quiz["additional"]*/ </div> </div> /*}*/ /* var quizContent = quiz[\'quizContent\'].replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); quizContent = quizContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="test-quiz"> <div class="test-title"> /*=gM.jsEnter(quizContent)*/ (/*if(quizDifficult == 0){ */ \u96be /*}else if(quizDifficult == 100){ */ \u6613 /*}else if(0<quizDifficult&&quizDifficult<50){ */ \u8f83\u96be /*}else if(50<quizDifficult&&quizDifficult< 100){ */ \u8f83\u6613 /*}else { */ \u4e2d /*} */) </div> /* include(\'quiz_option_oneByOne\',{baseType:baseType,options:quiz[\'quizOptionses\'],submit:submit,config:config}); */ </div> /*if(config.toggleTitle){*/ <p> <a href="javascript:void(0)" class="action-more" _type="toggleTitle">\u663e\u793a\u95ee\u9898\u63cf\u8ff0<i class="icon-arrow01"></i> </a> </p> /*}*/ </div> /*if(config.standard){*/ <div class="test-form" _type="edit_standard"> /* include(\'quiz_comment_add\',{standardAndRecord:standardAndRecord,index:1,config:config}); */ /*if(!config.controlEditModel){*/ <div class="form-action"> <a class="btn-new btn_add_option" href="javascript:void(0)"><i class="icon-new"></i>/*=Msg.get(\'exam.add.standard\')*/</a> </div> /*}*/ </div> /*}*/ /*if(config.showDifficult){*/ <div class="test-directory"> <span class="tdt-text">\u96be&nbsp;\u6613&nbsp;\u5ea6\uff1a</span> <span class="directory-text substr"> /*if(quizDifficult == 0){ */ \u96be /*}else if(quizDifficult == 100){ */ \u6613 /*}else if(0<quizDifficult&&quizDifficult<50){ */ \u8f83\u96be /*}else if(50<quizDifficult&&quizDifficult< 100){ */ \u8f83\u6613 /*}else { */ \u4e2d /*} */ </span> </div> /*}*/ </div>',{filename:"quiz_layout_oneByOne"});template.compile('/*if(ArrUtil.isArray(options)&&options.length>0){*/ <div class="test-options"> /* var check_class="input-c"; if(baseType!="itt004"){ check_class="input-r"; } var userAnswer=submit[\'userAnswer\']||""; var uA=userAnswer.split(",")||[]; for(var i=0; i< options.length;i++){ var option=options[i]; var optionId=option[\'optionId\']; var selectClass=""; if((config.userAnswer||config.practice)&&ArrUtil.contains(uA,optionId)){ selectClass="selected"; } var optionContent = option.optionContent.replace(new RegExp(\'\\\\$\\\\$\', \'gm\'), \'&&MathJax\'); optionContent = optionContent.replace(new RegExp(\'\\\\$\', \'gm\'), \'$$MathJax\'); */ <div class="t-option" option_id="/*=optionId*/"> <span class="option-order" > /*=String.fromCharCode("A".charCodeAt()+i) */\u3001</span> <span class="option-text"><em class="inner-txt">/*=optionContent*/</em></span> </div> /*}*/ </div> /*}*/',{filename:"quiz_option_oneByOne"});template.compile('/* if(config.reviewStandard&&typeof standardAndRecord!="undefined" && standardAndRecord.length>0){ */ <div class="mark-standard"> <label class="mark-label">/*=Msg.get(\'exam.score.standard\')*/</label> /*for(var i=0;i< standardAndRecord.length;i++){ var st=standardAndRecord[i].standard||[]; */ <p class="mt-para"> <span class="mt-no">/*=String.fromCharCode("a".charCodeAt()+i) */.</span> /*=st[\'standardDescribe\']*//*=Msg.get(\'exam.max.score\',st[\'standardScore\'])*/ </p> /*}*/ </div> /*}*/',{filename:"mark-standard"});template.compile('/* gM.log(standardAndRecord); gM.log(config.peerReview); if(config.peerReview&&ArrUtil.isArray(standardAndRecord)&&standardAndRecord.length>0){ var scoreClass="starndard-form"; if(config.standardForReview){ scoreClass="mark-score"; } */ <div class="mark-standard /*=scoreClass*/"> <label class="mark-label">/*=Msg.get(\'exam.review.score\')*/</label> /*for(var i=0;i< standardAndRecord.length;i++){ var st=standardAndRecord[i].standard||[]; var rv=standardAndRecord[i].record||[]; */ <p class="mt-para"> <span class="mt-no">/*=String.fromCharCode("a".charCodeAt()+i) */.</span> /*=st[\'standardDescribe\']*//*=Msg.get(\'exam.max.score\',st[\'standardScore\'])*/ </p> /*if(config[\'standardForReview\']){*/ <div class="input-group"> <label class="input-label">/*=Msg.get(\'exam.score2\')*/</label>/*=rv[\'reviewRecordScore\']*/ </div> /*} else if(config.standardForTrain){*/ <div class="input-group"> <label class="input-label">/*=Msg.get(\'exam.score\')*/</label> <input type="text" class="input-text validate[required,custom[integer],min[0]],max[/*=st[\'standardScore\']*/]]" id="quiz_standard_/*=quizId*/_/*=st.standardId*/" standard_id="/*=st.standardId*/" record_id="/*=rv.recordId*/"> <span class="t-score" style="display:none;"><i class="icon-person01"></i>/*=Msg.get(\'exam.review.score.tea\')*//*=rv[\'reviewRecordScore\']*/</span> </div> /*}else{*/ <div class="input-group"> <label class="input-label">/*=Msg.get(\'exam.score\')*/</label> <input type="text" class="input-text validate[required,custom[integer],min[0]],max[/*=st[\'standardScore\']*/]]" id="quiz_standard_/*=quizId*/_/*=st.standardId*/" value="/*=rv[\'reviewRecordScore\']*/" standard_id="/*=st.standardId*/" record_id="/*=rv.recordId*/"> </div> /*}*/ /*}*/ </div> /*if(config.standardForReview){*/ <div class="test-comment"> <label class="tcomment-label">/*=Msg.get(\'exam.comment\')*/</label> /*=review.reviewNotes*/ <div class="test-attach"> /* include(\'quiz_attr\',{baseType:baseType,nodeAttr:review[\'nodeAttr\'],download:true,delFlag:false,attrFlag:1}); */ </div> </div> /*if(review.exceptionFlag>0){ */ <div class="quiz-exception"> <label class="qe-label">\u6807\u7b7e\uff1a</label> <span class="qe-tag">/*=review.copyException==1?\'\u6d89\u5acc\u6284\u88ad\':\'\'*/ &nbsp /*=review.improperException==1?\'\u4e0d\u5f53\u8a00\u8bba\':\'\'*/</span> </div> /*}*/ /*}else if(config.standardForTrain){*/ <div class="test-comment"> <label class="tcomment-label">/*=Msg.get(\'exam.comment\')*/</label> <div class="input-area answer-area no_border validate[funcCallRequired[check500req]]" _type="comment_area"></div> <a href="javascript:void(0)" class="btn-public" _type="comment_upload">/*=Msg.get(\'exam.uploader\')*/</a> <div class="test-attach" _type="comment_attr"> </div> <div class="public-tip test_form_tip" style="display:none;"><i class="icon-person01"></i>/*=review.reviewNotes*/ </div> <div class="test-attach"> /* include(\'quiz_attr\',{nodeAttr:review[\'nodeAttr\'],download:true,delFlag:false,attrFlag:1}); */ </div> </div> /*}else{*/ <div class="test-comment"> <label class="tcomment-label">/*=Msg.get(\'exam.comment\')*/</label> /*if(review==null ||review.reviewNotes==null){*/    <div class="input-area answer-area no_border validate[funcCallRequired[check500req]]" _type="comment_area">无</div>/*}else{*/   <div class="input-area answer-area no_border validate[funcCallRequired[check500req]]" _type="comment_area">/*=review.reviewNotes*/</div>/*}*/  <a href="javascript:void(0)" class="btn-public" _type="comment_upload">/*=Msg.get(\'exam.uploader\')*/</a> <div class="test-attach" _type="comment_attr"> /* include(\'quiz_attr\',{nodeAttr:review[\'nodeAttr\'],download:true,delFlag:true,attrFlag:1}); */ </div> </div> <div class="quiz-exception"> <label class="qe-label">\u6807\u7b7e\uff1a</label> <span class="input-cr"><a href="javascript:void(0)" class="input-c input-c_exception /*=review.copyException==1?\'selected\':\'\'*/" _exceptionVal="1"></a>\u6d89\u5acc\u6284\u88ad</span> <span class="input-cr"><a href="javascript:void(0)" class="input-c input-c_exception /*=review.improperException==1?\'selected\':\'\'*/" _exceptionVal="2"></a>\u4e0d\u5f53\u8a00\u8bba</span> <p class="public-tip tip-prev"><i class="icon-tip"></i>\u5982\u679c\u6d89\u5acc\u6284\u88ad\uff0c\u8bf7\u5728\u8bc4\u8bed\u4e2d\u8bf4\u660e\u5982\u76f8\u5173\u7f51\u9875\u7684URL\u3001\u5176\u4ed6\u540c\u5b66\u7684\u7c7b\u4f3c\u7b54\u6848\u7b49\u8bc1\u636e\u3002 <br>\u5982\u679c\u4e0d\u5f53\u8a00\u8bba\uff0c\u8bf7\u5728\u8bc4\u8bed\u4e2d\u8bf4\u660e\u60a8\u8ba4\u4e3a\u8be5\u4f5c\u4e1a\u6709\u4e0d\u5f53\u8a00\u8bba\u7684\u7406\u7531\u3002</p> </div> /*}*/ /*}*/',{filename:"quiz_mark"});template.compile('/* var styleStr=""; if(config.autoReview){ styleStr="display:none"; } if((config.autoReview||config.response)&&ArrUtil.isArray(responses)&&responses.length>0){ var res=quizUtil.formatResponse(responses,options); if(res.rtype!=0&&res.content!=""){ */ <div class="test-ana" style="/*=styleStr*/" _type="response"> <span class="ana-text">/*=Msg.get(\'exam.quiz.answer\')*/</span> /* if(res.rtype!=1){ for(var i=0;i< res.content.length;i++){ var index=res.content[i]; */ /*=String.fromCharCode("A".charCodeAt()+index) */\u3001 /* } }else{ */ /*=gM.jsEnter(res.content.join("\\n"))*/ /* } */ </div> /*}*/ /*}*/ /*if((config.autoReview||config.solution)&&ArrUtil.isArray(solutions)&&solutions.length>0){*/ /* var hasFlag=ArrUtil.attrNotEmpty(solutions, \'content\'); if(hasFlag){ */ <div class="test-ana" style="/*=styleStr*/" _type="solution"> <span class="ana-text">/*=Msg.get(\'exam.quiz.response\')*/</span> /* for(var i=0; i< solutions.length;i++){ var solution=solutions[i]; */ /*=gM.jsEnter(solution.content)*/ /* } */ </div> /*}*/ /*}*/',{filename:"quiz_ana"});template.compile('/* if(config.userAnswer||config.practice){ var submitId=submit[\'submitId\']; var nodeAttr=submit[\'nodeAttr\']||[]; if(config.userEdit||config.practice){*/ <div class="test-ana test-ana-s"> <span class="ana-text">/*=Msg.get(\'exam.response\')*/</span> <div class="input-area answer-area no_border validate[funcCallRequired[notEmpty]]" _type="practice_area">/*=submit[\'userAnswer\']*/ </div> <p class="public-tip" style="display: none"><i class="icon-tip"></i>\u6b64\u5904\u4e0d\u53ef\u4e3a\u7a7a\uff01</p> <a href="javascript:void(0)" class="btn-public" _type="practice_upload">/*=Msg.get(\'exam.uploader\')*/</a> <div class="test-attach" _type="practice_attr"> /* include(\'quiz_attr\',{baseType:baseType,courseOpenId:courseOpenId,nodeAttr:nodeAttr,download:true,delFlag:true,attrFlag:1,officePlugFlag:config[\'officePlugFlag\']}); */ </div> </div> /*}else{*/ <div class="test-ana test-ana-s"> <span class="ana-text">/*=Msg.get(\'exam.response\')*/</span> <div class="answer-area no_border" _type="practice_area"> /*=submit[\'userAnswer\']*/ </div> <div class="test-attach"> /* include(\'quiz_attr\',{baseType:baseType,courseOpenId:courseOpenId,nodeAttr:nodeAttr,download:true,delFlag:false,attrFlag:1,officePlugFlag:config[\'officePlugFlag\']}); */ </div> </div> /*}*/ /*}*/',{filename:"quiz_user_ana"});template.compile('/* contextPath=CONTEXTPATH||""; attrFlag=attrFlag||0; officePlugFlag=officePlugFlag||0; if(ArrUtil.isArray(nodeAttr)&&nodeAttr.length>0){ var nodeAttr_length =nodeAttr.length; for(var i=0;i< nodeAttr.length;i++){ var node=nodeAttr[i]; var id=node[\'node_id\']||""; var name=node[\'node_name\']||"";var size=node[\'node_size\']||""; var state= node[\'node_state\']||0; var realName=""; var ext=""; if(name.indexOf(".")>0){ realName="\u9644\u4ef6"+(nodeAttr_length>1?(i+1):"");ext=name.substring(name.lastIndexOf("."),name.length);}else{ realName=ext; } */ <p class="test-para" _node_id=\'/*=id*/\' _thumbnails_path="/*=node[\'thumbnailsPath\']*/" temp_path="/*=node[\'fileTempPath\']*/" relative_path="/*=node[\'fileRelativePath\']*/" absolute_path="/*=node[\'fileAbsolutePath\']*/" file_name="/*=name*/" file_size="/*=size*/" > <span class="file-name substr mw135" title="/*=fileName*/">/*=realName*/</span>/*=ext*/ <span class="doc-size">\uff08/*=fileUtils.fileSize(size)*/\uff09</span> /*if(state==1){ if(attrFlag==\'1\'){*/ <a class="link-action" href="javascript:gM.viewAttr(\'/*=id*/\');">/*=Msg.get(\'exam.preview\')*/</a> /*}else{*/ <a class="link-action" href="javascript:gM.viewNodes(\'/*=id*/\');">/*=Msg.get(\'exam.preview\')*/</a> /*}}*/ /*if(download){ if(attrFlag==\'1\'){ if(officePlugFlag==\'2\' && (ext.toLocaleLowerCase().lastIndexOf(\'doc\')>-1 || ext.toLocaleLowerCase().lastIndexOf(\'docx\')>-1)){*/  <a class="link-action" href="javascript:gM.viewInOfficeHd(\'/*=courseOpenId*/\',\'/*=id*/\');">\u6279\u9605</a> /*}else if(officePlugFlag==\'1\' && (ext.toLocaleLowerCase().lastIndexOf(\'doc\')>-1 || ext.toLocaleLowerCase().lastIndexOf(\'docx\')>-1)){*/ <a class="link-action" href="javascript:gM.viewInOfficeRo(\'/*=courseOpenId*/\',\'/*=id*/\');">\u67E5\u770B</a> /*}else{*/ <a class="link-action" href="/*=contextPath*//download/attr//*=courseOpenId*///*=id*/.mooc" taget="_blank">/*=Msg.get(\'exam.download\')*/</a>/*if(baseType==\'itt011\'){*/ <a class="link-action" href="/*=contextPath*//download/readWatch//*=courseOpenId*///*=id*/.mooc" target="_blank" >查看</a> /* }*//*}}else{if(courseOpenId != null && courseOpenId != \'\' && courseOpenId != 0){*/<a class="link-action" href="/*=contextPath*//download/nodes//*=courseOpenId*///*=id*/.mooc" taget="_blank">/*=Msg.get(\'exam.download\')*/</a> /*if(baseType==\'itt011\'){*/ <a class="link-action" href="/*=contextPath*//download/docWatch//*=courseOpenId*///*=id*/.mooc" target="_blank" >查看</a> /* }*/ /*}else{*/<a class="link-action" href="/*=contextPath*//download/attr//*=id*/.mooc" taget="_blank">/*=Msg.get(\'exam.download\')*/</a> /*if(baseType==\'itt011\'){*/ <a class="link-action" href="/*=contextPath*//download/readWatch//*=courseOpenId*///*=id*/.mooc" target="_blank">查看</a> /* }*//*}}}*/ /*if(delFlag){*/ <a class="link-action" href="javascript:void(0)" _type="del_user_ana_attr">/*=Msg.get(\'exam.delete\')*/</a> /* }*/ </p> /*}}*/',{filename:"quiz_attr"});template.compile('/* contextPath=CONTEXTPATH||""; attrFlag=attrFlag||0; officePlugFlag=officePlugFlag||0; if(ArrUtil.isArray(nodeAttr)&&nodeAttr.length>0){ var nodeAttr_length =nodeAttr.length; for(var i=0;i< nodeAttr.length;i++){ var node=nodeAttr[i]; var id=node[\'node_id\']||""; var name=node[\'node_name\']||"";var size=node[\'node_size\']||""; var state= node[\'node_state\']||0; var realName=""; var ext=""; if(name.indexOf(".")>0){ realName="\u9644\u4ef6"+(nodeAttr_length>1?(i+1):"");ext=name.substring(name.lastIndexOf("."),name.length);}else{ realName=ext; } */ <p class="test-para" _node_id=\'/*=id*/\' _thumbnails_path="/*=node[\'thumbnailsPath\']*/" temp_path="/*=node[\'fileTempPath\']*/" relative_path="/*=node[\'fileRelativePath\']*/" absolute_path="/*=node[\'fileAbsolutePath\']*/" file_name="/*=name*/" file_size="/*=size*/" > <span class="file-name substr mw135" title="/*=fileName*/">/*=realName*/</span>/*=ext*/ <span class="doc-size">\uff08/*=fileUtils.fileSize(size)*/\uff09</span> /*if(state==1){ if(attrFlag==\'1\'){*/ <a class="link-action" href="javascript:gM.viewAttr(\'/*=id*/\');">/*=Msg.get(\'exam.preview\')*/</a> /*}else{*/ <a class="link-action" href="javascript:gM.viewNodes(\'/*=id*/\');">/*=Msg.get(\'exam.preview\')*/</a> /*}}*/ /*if(download){ if(attrFlag==\'1\'){ if(officePlugFlag==\'2\' && (ext.toLocaleLowerCase().lastIndexOf(\'doc\')>-1 || ext.toLocaleLowerCase().lastIndexOf(\'docx\')>-1)){*/  <a class="link-action" href="javascript:gM.viewInOfficeHd(\'/*=courseOpenId*/\',\'/*=id*/\');">\u6279\u9605</a> /*}else if(officePlugFlag==\'1\' && (ext.toLocaleLowerCase().lastIndexOf(\'doc\')>-1 || ext.toLocaleLowerCase().lastIndexOf(\'docx\')>-1)){*/ <a class="link-action" href="javascript:gM.viewInOfficeRo(\'/*=courseOpenId*/\',\'/*=id*/\');">\u67E5\u770B</a> /*}else{*/ <a class="link-action" href="/*=contextPath*//download/nodes//*=courseOpenId*///*=id*/.mooc" taget="_blank">/*=Msg.get(\'exam.download\')*/</a>/*}}else{if(courseOpenId != null && courseOpenId != \'\' && courseOpenId != 0){*/<a class="link-action" href="/*=contextPath*//download/nodes//*=courseOpenId*///*=id*/.mooc" taget="_blank">/*=Msg.get(\'exam.download\')*/</a> /*}else{*/<a class="link-action" href="/*=contextPath*//download/nodes//*=id*/.mooc" taget="_blank">/*=Msg.get(\'exam.download\')*/</a> /*}}}*/ /*if(delFlag){*/ <a class="link-action" href="javascript:void(0)" _type="del_user_ana_attr">/*=Msg.get(\'exam.delete\')*/</a> /* }*/ /*if(baseType==\'itt011\'){*/ <a class="link-action" href="/*=contextPath*//download/docWatch//*=courseOpenId*///*=id*/.mooc" target="_blank" >查看</a> /* }*/ </p> /*}}*/',{filename:"quiz_attr_node"});template.compile('/*if(config.teaReview){*/ /*if(config.standardForReview){*/ <div class="test-comment"> <label class="tcomment-label">/*=Msg.get(\'exam.review.score\')*/</label> <em>/*=review.reviewScore*/</em> </div> /*}else{ var reviewId=review[\'reviewId\']||{}; */ <div class="test-form"> <div class="form-item"> <div class="input-group"> <label class="input-label">/*=Msg.get(\'exam.review.score\')*/</label> <input type="text" id="reviewScore_/*=reviewId*/" class="input-text input-check validate[required,custom[integer],min[0]]" review_id="/*=reviewId*/" value="/*=review.reviewScore*/"> </div> </div> </div> /*}*/ <div class="test-comment"> <label class="tcomment-label">/*=Msg.get(\'exam.comment\')*/</label> /*if(config.standardForReview){*/ /*=review.reviewNotes*/ <div class="test-attach"> /* include(\'quiz_attr\',{nodeAttr:review[\'nodeAttr\'],download:true,delFlag:false}); */ </div> /*}else{if(review==null ||review.reviewNotes==null){*/    <div class="input-area answer-area no_border validate[funcCallRequired[check500req]]" _type="comment_area">无</div>/*}else{*/   <div class="input-area answer-area no_border validate[funcCallRequired[check500req]]" _type="comment_area">/*=review.reviewNotes*/</div>/*}*/ <a href="javascript:void(0)" class="btn-public" _type="comment_upload">/*=Msg.get(\'exam.uploader\')*/</a> <div class="test-attach" _type="comment_attr"> /* include(\'quiz_attr\',{nodeAttr:review[\'nodeAttr\'],download:true,delFlag:true}); */ </div> /*}*/ </div> /*}*/',{filename:"quiz_comment"});template.compile('/* if(!ArrUtil.isArray(standardAndRecord)){ standardAndRecord=[]; } var uId; for(var i=0;i< standardAndRecord.length;i++){ var st=standardAndRecord[i]; var standardId= st[\'standardId\']; var info=st[\'standard\']; uId=gM.getRID(); */ <div class="form-item"> <div class="input-group"> <label class="input-label"><b>*</b>/*=Msg.get(\'exam.standard\')*//*=index*/</label> <input class="input_standard_id" type="hidden" value="/*=standardId*/"> <input type="text" class="input-text input-check validate[required,custom[integer],min[1]]" coustom_target="/*=uId*/" value="/*=info[\'standardScore\']*/" /*=config.controlEditModel?"disabled":""*/> <span class="print-text" id="/*=uId*/">%</span> </div> <div class="input-group"> <input type="text" class="input-text input-intro validate[required]" value="/*=info[\'standardDescribe\']*/"> /*if(!config.controlEditModel){*/ <i class="icon-del01 del_option"></i> /*}*/ </div> </div> /* index++; } if(0==standardAndRecord.length){ uId=gM.getRID(); */ <div class="form-item"> <div class="input-group"> <label class="input-label"><b>*</b>/*=Msg.get(\'exam.standard\')*//*=index*/</label> <input class="input_standard_id" type="hidden" value=""> <input type="text" class="input-text input-check validate[required,custom[integer],min[1]]" coustom_target="/*=uId*/" > <span class="print-text" id="/*=uId*/">%</span> </div> <div class="input-group"> <input type="text" class="input-text input-intro validate[required]"> <i class="icon-del01 del_option"></i> </div> </div> /* } */',{filename:"quiz_comment_add"});template.compile('<li /* if(all.quizTypeId == selected){ */ class="tab-active" /*}*/ > <a class="tab-inner" href="javascript:void(0)" typeid=""><span class="tabs-title">/*=all.quizTypeName */(/*=all.quizNum*/)</span></a> </li> /* for( var i=0;i< list.length ;i++) { var type=list[i]; if(typeof type.quizNum!="undefined"&&type.quizNum>0){ */ <li /* if(type.quizTypeId == selected){ */ class="tab-active" /* } */ > <a class="tab-inner" href="javascript:void(0)" typeid="/*=type.quizTypeId*/"><span class="tabs-title">/*=type.quizTypeName */(/*=type.quizNum*/)</span></a> </li> /* }} */',{filename:"view_type"})})();(function($){var quizFactory=function(targetId,args){var _t="#"+targetId;var $Div=$(_t);$Div.data("quizFactory","complete");var pro={quiz:{quizId:"quizId",quiz:"quiz",submit:"submit",review:"review",standardAndRecord:{standardId:"standardId",standard:"standard",record:"record"}},quizList:[],_paper:{},_quiz:[],_submit:{},_submitQuiz:[],_standard:[],_review:[],allUserAnswers:[],courseOpenId:0};var defArg={idFormat:"{targetId}_{quizId}",start:null,icon:false,solution:false,response:false,toggleTitle:false,userAnswer:false,userEdit:false,practice:false,autoReview:false,practiceView:false,controlEditModel:false,reviewModel:false,practiceChange:null,preView:false,peerReview:false,teaReview:false,statistics:false,groupOpt1:false,quizEdit:false,changePath:false,quizDel:false,standard:false,reviewStandard:false,standardForReview:false,standardForTrain:false,libEdit:false,libEditCallback:null,libView:false,showDifficult:true,showOneByOne:false,officePlugFlag:0};var layout=function(){var quizList=pro.quizList||[];var length=quizList.length||0;var _c;var quizHtml=[];var quiz,quizId,submitId,reviewId="";if(config.randomNum&&config.randomNum>0&&length>0){var quizListTmp=quizList.concat();for(var i=0;i<config.randomNum;i++){var r=Math.floor(Math.random()*quizListTmp.length);quiz=quizListTmp[r]||{};quizId=quiz.quizId||"";_c=$.extend({},config);_c.index=i;var idf=config.idFormat||"";if(idf.length==0){idf=defArg.idFormat}if(idf.indexOf("{targetId}")>-1){idf=idf.replace(new RegExp("{targetId}","g"),targetId)}if(idf.indexOf("{quizId}")>-1){idf=idf.replace(new RegExp("{quizId}","g"),quizId)}if(idf.indexOf("{submitId}")>-1){submitId=quiz.submitId||"";idf=idf.replace(new RegExp("{submitId}","g"),submitId)}if(idf.indexOf("{reviewId}")>-1){if(typeof quiz.review!="undefined"&&typeof quiz.review["reviewId"]!="undefined"){reviewId=quiz.review["reviewId"]||""}idf=idf.replace(new RegExp("{reviewId}","g"),reviewId)}_c.divId=idf;quizHtml.push(element.quizTemplate(quiz,_c));quizListTmp.splice(r,1);if(quizListTmp.length==0){break}}}else{for(var i=0;i<length;i++){quiz=quizList[i]||{};quizId=quiz.quizId||"";_c=$.extend({},config);_c.index=i;var idf=config.idFormat||"";if(idf.length==0){idf=defArg.idFormat}if(idf.indexOf("{targetId}")>-1){idf=idf.replace(new RegExp("{targetId}","g"),targetId)}if(idf.indexOf("{quizId}")>-1){idf=idf.replace(new RegExp("{quizId}","g"),quizId)}if(idf.indexOf("{submitId}")>-1){submitId=quiz.submitId||"";idf=idf.replace(new RegExp("{submitId}","g"),submitId)}if(idf.indexOf("{reviewId}")>-1){if(typeof quiz.review!="undefined"&&typeof quiz.review["reviewId"]!="undefined"){reviewId=quiz.review["reviewId"]||""}idf=idf.replace(new RegExp("{reviewId}","g"),reviewId)}_c.divId=idf;quizHtml.push(element.quizTemplate(quiz,_c))}}var _layout=$(quizHtml.join(""));try{$(".test-title .mathquill-embedded-latex:not(.mathquill-rendered-math)",_layout).mathquill();$(".test-options .mathquill-embedded-latex:not(.mathquill-rendered-math)",_layout).mathquill();$(".test-ana:not(.test-ana-s) .mathquill-embedded-latex:not(.mathquill-rendered-math)",_layout).mathquill();if(!config.practice){$(".test-ana-s .mathquill-embedded-latex:not(.mathquill-rendered-math)",_layout).mathquill()}if(!config.reviewModel){$(".test-comment .mathquill-embedded-latex:not(.mathquill-rendered-math)",_layout).mathquill()}$(".public-tip.test_form_tip .mathquill-embedded-latex:not(.mathquill-rendered-math)",_layout).mathquill()}catch(e){gM.log(e)}$Div.html(_layout);element.eventAll();config.success&&config.success(targetId)};var loadMathJax=function(){try{MathJax.Hub.Queue(["Typeset",MathJax.Hub])}catch(e){console.info(e)}};var element={delLib:function(){var $this=$(this);var type=$("#type").val();var $thisId;if(type=="quiz"){$thisId=$this.attr("quiz_id")}else{$thisId=$this.attr("node_id")}if(typeof $thisId!="undefined"&&$thisId!=null){var dg=$.dialog.confirm("确定要移除资源目录么？他将被转移到根目录！",function(){if(type=="quiz"){$.ajax({url:CONTEXTPATH+"/lib/moveRootQuiz/"+$thisId+".mooc",type:"post",async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));config.libEditCallback&&config.libEditCallback();dg&&dg.close()}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})}else{$.ajax({url:CONTEXTPATH+"/lib/moveRoot/"+$thisId+".mooc",type:"post",async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));config.libEditCallback&&config.libEditCallback();dg&&dg.close()}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})}return false},function(){})}},quizTemplate:function(data,config){if(config.templateId){return template(config.templateId,{data:data,config:config})}else{if(config.showOneByOne){return template("quiz_layout_oneByOne",{data:data,config:config})}else{if(pro.courseOpenId!=0){return template("quiz_layout_courseOpenId",{data:data,config:config,courseOpenId:pro.courseOpenId})}else{return template("quiz_layout",{data:data,config:config})}}}},checkStandardOption:function(){$("#"+targetId).find('[_type="edit_standard"]').each(function(i,n){var $n=$(n);$(".del_option:eq(0)",$n).hide();$(".del_option:lt(0)",$n).show()})},eventAll:function(){if(config.standard){element.checkStandardOption()}if(config.reviewModel){$('[_type="comment_area"]',"#"+targetId).each(function(i,n){var $this=$(n);var $thisId=$this.attr("id");if(typeof $thisId=="undefined"){$thisId=gM.getRID();$this.attr("id",$thisId)}element.initUmEditQuiz($thisId,null,80)});$('[_type="comment_upload"]',"#"+targetId).each(function(i,n){var $this=$(n);var $attrDiv=$(n).next(".test-attach");var $thisId=$this.attr("id");var $attrDivId=$attrDiv.attr("id");if(typeof $thisId=="undefined"){$thisId=gM.getRID();$this.attr("id",$thisId)}if(typeof $attrDivId=="undefined"){$attrDivId=gM.getRID();$attrDiv.attr("id",$attrDivId)}element.initUpload($thisId,$attrDivId)})}if(config.practice){$('[_type="practice_area"]',"#"+targetId).each(function(i,n){var $this=$(n);var $thisId=$this.attr("id");if(typeof $thisId=="undefined"){$thisId=gM.getRID();$this.attr("id",$thisId)}var uedit=element.initUmEditQuiz($thisId,null,80);if(config.practiceView){uedit.disable()}});$('[_type="practice_upload"]',"#"+targetId).each(function(i,n){var $this=$(n);var $attrDiv=$(n).next(".test-attach");var $thisId=$this.attr("id");var $attrDivId=$attrDiv.attr("id");if(typeof $thisId=="undefined"){$thisId=gM.getRID();$this.attr("id",$thisId)}if(typeof $attrDivId=="undefined"){$attrDivId=gM.getRID();$attrDiv.attr("id",$attrDivId)}if(!config.practiceView){element.initUpload($thisId,$attrDivId,function(id,divId){var $upload=$("#"+divId);var _edit=UM.getEditor($upload.closest(".test-ana-s").find(".edui-body-container").eq(0).attr("id"));if($.trim(_edit.getContentTxt()).length==0){_edit.setContent("详情见附件",true)}})}})}else{if(config.userAnswer){$(".test-ana-s").each(function(){var answerTest="";var answerAttr="";var answerEmptyFlag=true;answerTest=$.trim($(this).find(".answer-area").text()||"");if(answerTest.length>0){answerEmptyFlag=false}else{if($(this).find(".answer-area img").length>0){answerEmptyFlag=false}}answerAttr=$.trim($(this).find(".test-attach").text()||"");if(answerAttr.length>0){answerEmptyFlag=false}if(answerEmptyFlag){$(this).find(".answer-area").text("[该题未作答]")}})}}},addStandardOption:function(){var index=$(this).parents(".test-form").find(".form-item").size()+1;var optionHtml=template("quiz_comment_add",{index:index});$(this).parents(".form-action").before(optionHtml);element.checkStandardOption()},deleteStandardOption:function(){var $btnDelter=$(this);var $form=$btnDelter.parents(".test-form");$btnDelter.parents(".form-item").remove();$form.find(".form-item").each(function(index){$(this).find(".input-label").text(Msg.get("exam.standard")+(index+1)).prepend("<b>*</b>")});element.checkStandardOption()},r_input_click:function(){if(config.practiceView){return}var $radio=$(this);$radio.parents(".test-options").find(".input-r.selected").removeClass("selected");$radio.addClass("selected");var rIndex=$(this).parents(".practice-item").index();config.practiceChange&&config.practiceChange(rIndex,1)},c_input_click:function(){if(config.practiceView){return}if(config.showOneByOne){var $checkbox=$(this);$checkbox.parent().siblings().removeClass("selected");$checkbox.parent().toggleClass("selected")}else{var $checkbox=$(this);$checkbox.toggleClass("selected");var rIndex=$(this).parents(".practice-item").index();var doneFlag=0;$(this).closest(".practice-item").find(".t-option").each(function(){if($(this).find(".input-c").hasClass("selected")){doneFlag=1}})}config.practiceChange&&config.practiceChange(rIndex,doneFlag)},exception_input_click:function(){var $checkbox=$(this);$checkbox.toggleClass("selected")},del_user_ana_attr:function(){if(config.practiceView){return}var $opt=$(this);$opt.closest(".test-para").remove()},initUmEditQuiz:function(id,w,h){setTimeout(function(){initUmEditQuiz(id,w,h)},800)},initUpload:function(id,divId,rightCallBack){var uploadArr=[];var _id="#"+id;$(_id).uploader({buttonHeight:30,buttonWidth:130,uploadUrl:CONTEXTPATH+"/upload/file/resource.mooc",buttonTemplate:'<a href="javascript:void(0)" class="btn-public">'+Msg.get("exam.uploader")+"</a>",onSelect:function(file){var size=file.size;var type=file.type;type=type||".";type=type.substring(1,type.length).toLowerCase();if(((type+"").length>0)&&checkDocumentType(type)){if(size<=30*1024*1024){}else{$.dialog.error("文档超出文件大小限制，单个最大30M");return false}}else{if(((type+"").length>0)&&checkVideoType(type)){if(size<=50*1024*1024){}else{$.dialog.error("视频超出文件大小限制，单个最大50M");return false}}else{if(size<=30*1024*1024){}else{$.dialog.error("附件超出文件大小限制，单个最大30M");return false}}}var $$div=null;var $$progress=null;var uploadId=gM.getUploadId(file.id||file.name);if(typeof uploadArr[uploadId]=="undefined"){var _b={};_b.node_size=file.size;_b.node_name=file.name.replace(new RegExp(",","g"),"，");var aHtml=template("quiz_attr",{nodeAttr:[_b],delFlag:true,download:false});$$div=$(aHtml);$$progress=$('<div class="progressbar-bg" id="progress"><div class="progressbar-in"></div></div>');$$progress.attr("id","upload_attr_node_progress_"+uploadId);$$div.attr("id","upload_attr_node_div_"+uploadId);$$div.addClass("link-action-parent-div");uploadArr[uploadId]={$$div:$$div,$$progress:$$progress}}else{$$div=uploadArr[uploadId]["$$div"];$$progress=uploadArr[uploadId]["$$progress"]}var t=false;$("#"+divId).append($$div);$$div.data("fileId",file);$$div.on("click",".link-action",function(){var fileId=$(this).closest(".link-action-parent-div").data("fileId");if(!fileId){return}else{$("#upload_attr_node").uploader("cancel",fileId)}});$$div.append($$progress);$$progress.position({of:$$div,my:"left+270 center-7",at:"left center",collision:"flip flip "});return !t},onUploadProgress:function(file,fileBytesLoaded,fileTotalBytes){var uploadId=gM.getUploadId(file.id);var $$div=uploadArr[uploadId]["$$div"];var $$progress=uploadArr[uploadId]["$$progress"];var percentage=Math.round(fileBytesLoaded/fileTotalBytes*100);$(".progressbar-in",$$progress).css({width:percentage+"% "})},onUploadSuccess:function(file,JsonStr){var uploadId=gM.getUploadId(file.id);var $$div=uploadArr[uploadId]["$$div"];var $$progress=uploadArr[uploadId]["$$progress"];$$progress&&$$progress.remove();uploadArr[uploadId]["$$progress"]=null;var JsonData=JSON.parse(JsonStr);if(JsonData.resultStatus=="1"){var _b=$.extend({},JsonData);_b.node_size=file.size;_b.node_name=file.name.replace(new RegExp(",","g"),"，");var aHtml=template("quiz_attr",{nodeAttr:[_b],delFlag:true,download:false});var $_this=$(aHtml);$$div.after($_this);$$div&&$$div.remove();uploadArr[uploadId]["$$div"]=null;$_this.find(".link-action").on("click",function(){$_this&&$_this.remove()});rightCallBack&&rightCallBack(id,divId)}else{$(".link-action-parent-div").remove();$.dialog.error("上传失败，请稍后再试！")}},onCancel:function(file){var uploadId=gM.getUploadId(file.id);var $$div=uploadArr[uploadId]["$$div"];var $$progress=uploadArr[uploadId]["$$progress"];$$progress&&$$progress.remove();$$div&&$$div.remove();uploadArr[uploadId]["$$progress"]=null;uploadArr[uploadId]["$$div"]=null},onUploadError:function(file){var uploadId=gM.getUploadId(file.id);var $$div=uploadArr[uploadId]["$$div"];var $$progress=uploadArr[uploadId]["$$progress"];$$progress&&$$progress.remove();$$div&&$$div.remove();uploadArr[uploadId]["$$progress"]=null;uploadArr[uploadId]["$$div"]=null;uploadArr[uploadId]=null;$(".link-action-parent-div").remove();$.dialog.error("上传失败，请稍后再试！")}})},toggleTitle:function(){var $this=$(this);if(!$this.hasClass("link-open")){$(this).addClass("link-open").html("隐藏问题描述<i class='icon-arrow01'></i>");$(this).parents(".view-test").find(".test-header").slideDown()}else{$(this).removeClass("link-open").html("显示问题描述<i class='icon-arrow01'></i>");$(this).parents(".view-test").find(".test-header").slideUp()}}};var handler={isArray:function(obj){return arrUtil.isArray(obj)},getStandard:function(standardList,quizId){var _r=[];if(typeof quizId=="undefined"||!handler.isArray(standardList)||standardList.length==0){return _r}var standard,standardId;for(var i=0;i<standardList.length;i++){standard=standardList[i]||{};standardId=standard.standardId;if(standard.quizId==quizId){_r.push({standardId:standardId,standard:standard})}}standard=null;standardId=null;return _r},mergeStandard:function(standardReview,standardList,quizId){standardReview=standardReview||[];var _r=[];if(typeof quizId=="undefined"||!handler.isArray(standardList)||standardList.length==0){return _r}var standard,standardId;var _l,_sAr;for(var i=0;i<standardList.length;i++){standard=standardList[i]||{};standardId=standard.standardId;if(typeof standardId=="undefined"){break}var sAr={};_l=standardReview.length;while(_l--){_sAr=standardReview[_l];if(_sAr.standardId==standardId){sAr=_sAr;break}}sAr.standardId=standardId;if(standard.quizId==quizId){sAr.standard=standard;_r.push(sAr)}}standard=null;standardId=null;return _r},getRecord:function(reviewList,quizId){var _r=[];if(typeof quizId=="undefined"||!handler.isArray(reviewList)||reviewList.length==0){return _r}var review,standardId;for(var i=0;i<reviewList.length;i++){review=reviewList[i]||{};standardId=review.standardId;if(review.quizId==quizId){_r.push({standardId:standardId,record:review})}}review=null;standardId=null;return _r},mergeRecord:function(standardReview,reviewList,quizId){standardReview=standardReview||[];var _r=[];if(typeof quizId=="undefined"||!handler.isArray(reviewList)||reviewList.length==0){return _r}var review,standardId;var _l,_sAr;for(var i=0;i<reviewList.length;i++){review=reviewList[i]||{};standardId=review.standardId;if(typeof standardId=="undefined"){break}var sAr={};_l=standardReview.length;while(_l--){_sAr=standardReview[_l];if(_sAr.standardId==standardId){sAr=_sAr;break}}sAr.standardId=standardId;sAr.record=review;_r.push(sAr)}review=null;standardId=null;return _r},getUserAnswerResult:function(curQuizOption,quiz){var errorFlag="right";var answer=quiz.quizResponses;if(answer.length==0){return errorFlag}if(curQuizOption.length>0){var _qAnswer=curQuizOption.split(",");if(_qAnswer.length==answer.length){for(var j=0;j<answer.length;j++){var _option=","+curQuizOption+",";if(_option.indexOf((","+answer[j]["optionId"])+",")<0){errorFlag="error"}}}else{errorFlag="error"}}else{errorFlag="undo"}return errorFlag}};var pub={loading:null,destroy:function(){},setConfig:function(args){config=$.extend({},config,args);return pub},builder:function(){layout();loadMathJax();return pub},setQuiz:function(quizList){if(typeof quizList!="undefined"&&handler.isArray(quizList)){pro._quiz=quizList;var qList=[];var quiz,quizId;var _n_id,_n_name,_n_size,_node;var node_id,node_name,node_size,node,node_state;for(var i=0;i<quizList.length;i++){_n_id=[];_n_name=[];_n_size=[];quiz=quizList[i]||{};quizId=quiz.quizId;node=[];var quizTypeId=quiz.quizTypeId||"";if(typeof quizId!="undefined"){node_id=quiz.attrNodeId;node_name=quiz.attrNodeName;node_size=quiz.attrNodeSize;node_state=JSON.parse(quiz.attrNodeState||"{}");if(typeof node_id!="undefined"&&$.trim(node_id+"").length>0&&node_id.indexOf(",")>=0){_n_id=node_id.split(",");_n_id.length--;_n_id.shift();if(typeof node_name!="undefined"&&$.trim(node_name+"").length>0&&node_name.indexOf(",")>=0){_n_name=node_name.split(",");_n_name.length--;_n_name.shift()}if(typeof node_size!="undefined"&&$.trim(node_size+"").length>0&&node_size.indexOf(",")>=0){_n_size=node_size.split(",");_n_size.length--;_n_size.shift()}}for(var j=0;j<_n_id.length;j++){_node={};_node.node_id=_n_id[j];_node.node_name=_n_name[j];_node.node_size=_n_size[j];_node.node_state=node_state[_n_id[j]]||0;node.push(_node)}quiz.nodeAttr=node;quiz.baseType=(quizTypeId+"      ").substring(0,6).toLowerCase();qList.push({quizId:quizId,quiz:quiz})}else{gM.log("error setQuiz: undefined quiz find in  quizList",quiz)}}pro.quizList=qList;qList=null,quiz=null,quizId=null;node_id=null,node_name=null,node_size=null;_n_id=[],_n_name=[],_n_size=[]}return pub},addQuiz:function(quiz){quiz=quiz||{};if(typeof quiz.quizId!="undefined"){var quizId=quiz.quizId;var qList=pro._quiz;if(!handler.isArray(qList)){qList=[]}var flag=0;while(flag==0){flag=1;for(var i=0;i<qList.length;i++){var _quiz=qList[i];if(typeof _quiz.quizId!="undefined"&&_quiz.quizId==quizId){qList.splice(i,1);flag=0;break}}}qList.push(quiz);pub.setQuiz(qList)}return pub},delQuiz:function(quizId){var qList=pro._quiz;if(!handler.isArray(qList)){qList=[]}var flag=0;var _quiz;while(flag==0){flag=1;for(var i=0;i<qList.length;i++){_quiz=qList[i];if(typeof _quiz.quizId!="undefined"&&_quiz.quizId==quizId){delete _quiz;qList.splice(i,1);flag=0;break}}}pro._quiz=qList;qList=pro.quizList;if(!handler.isArray(qList)){qList=[]}flag=0;while(flag==0){flag=1;for(var i=0;i<qList.length;i++){var _quiz=qList[i];if(typeof _quiz.quizId!="undefined"&&_quiz.quizId==quizId){delete _quiz;qList.splice(i,1);flag=0;break}}}pro.quizList=qList;return pub},getQuiz:function(quizId){var qList=pro._quiz;if(!handler.isArray(qList)){qList=[]}if(typeof quizId=="undefined"){return qList}else{for(var i=0;i<qList.length;i++){var _quiz=qList[i]||{};if(typeof _quiz.quizId!="undefined"&&_quiz.quizId==quizId){return _quiz}}}return qList},getData:function(key,value){var qList=pro.quizList;if(!handler.isArray(qList)){qList=[]}if(typeof key=="undefined"||typeof value=="undefined"){return qList}else{for(var i=0;i<qList.length;i++){var _quiz=qList[i];if(typeof _quiz[key]!="undefined"&&_quiz[key]==value){return _quiz}}}return qList},setPaper:function(paper){paper=paper||{};var paperStruct=paper.paperStruct;var quizList=[];if(!handler.isArray(paperStruct)){paperStruct=[]}var quiz;for(var i=0;i<paperStruct.length;i++){var struct=paperStruct[i]||{};quiz=struct.quiz||{};quiz.quizScore=struct.quizScore;if(typeof quiz.quizId!="undefined"){quizList.push(quiz)}}pub.setQuiz(quizList);pro._paper=paper;return pub},setCourseOpenId:function(courseOpenId){pro.courseOpenId=courseOpenId;return pub},setSubmitQuiz:function(submitQuizList){submitQuizList=submitQuizList||[];if(typeof submitQuizList!="undefined"&&handler.isArray(submitQuizList)){var qList=pro.quizList||[];var sqList=[];var quiz,quizId,submit,submitQuizId;for(var i=0;i<qList.length;i++){quiz=qList[i];quizId=quiz.quizId;quiz.submit=null;submit={};var attrNodeId,attrNodeName,attrNodeSize,attrNode=[],attrNodeState;var arr_nId,arr_nName,arr_nSize,attr_node;for(var j=0;j<submitQuizList.length;j++){submit=submitQuizList[j];submitQuizId=submit.quizId;attrNode=[];if(typeof submitQuizId!="undefined"){if(submitQuizId==quizId){attrNodeId=submit.attrNodeId||"";attrNodeName=submit.attrNodeName||"";attrNodeSize=submit.attrNodeSize||"";attrNodeState=JSON.parse(submit.attrNodeState||"{}");arr_nId=[],arr_nName=[],arr_nSize=[];if(typeof attrNodeId!="undefined"&&$.trim(attrNodeId+"").length>0&&attrNodeId.indexOf(",")>=0){arr_nId=attrNodeId.split(",");arr_nId.length--;arr_nId.shift();if(typeof attrNodeName!="undefined"&&$.trim(attrNodeName+"").length>0&&attrNodeName.indexOf(",")>=0){arr_nName=attrNodeName.split(",");arr_nName.length--;arr_nName.shift()}if(typeof attrNodeSize!="undefined"&&$.trim(attrNodeSize+"").length>0&&attrNodeSize.indexOf(",")>=0){arr_nSize=attrNodeSize.split(",");arr_nSize.length--;arr_nSize.shift()}}for(var x=0;x<arr_nId.length;x++){attr_node={};attr_node.node_id=arr_nId[x];attr_node.node_name=arr_nName[x];attr_node.node_size=arr_nSize[x];attr_node.node_state=attrNodeState[arr_nId[x]]||0;attrNode.push(attr_node)}break}}else{gM.log("error setSubmit: undefined quiz find in  quizList",submit)}}submit.nodeAttr=attrNode;quiz.submit=submit;sqList.push(quiz)}pro.quizList=sqList;sqList=null,qList=null,quiz=null,quizId=null,submit=null,submitQuizId=null;pro._submitQuiz=submitQuizList}return pub},setSubmit:function(submit){submit=submit||{};var submitQuizList;var submitNodeList;if(typeof submit!="undefined"&&typeof submit.submitId!="undefined"){if(submit.submitContentFlag=="2"){submitQuizList=JSON.parse(submit.submitContent||"[]");submitNodeList=JSON.parse(submit.attrContent||"[]");for(var i=0;i<submitQuizList.length;i++){if(typeof submitQuizList[i]=="string"){submitQuizList[i]=JSON.parse(submitQuizList[i])}if(typeof submitQuizList[i]["submitId"]=="undefined"){submitQuizList[i]["submitId"]=submit.submitId}}pub.setSubmitQuiz(submitQuizList);pro._submit=submit;pub.setSubmitNode(submitNodeList)}else{submitQuizList=submit.examQuizs||[];pub.setSubmitQuiz(submitQuizList);pro._submit=submit}}submitQuizList=null;return pub},setSubmitNode:function(submitNodeList){submitNodeList=submitNodeList||[];if(typeof submitNodeList!="undefined"&&handler.isArray(submitNodeList)){var qList=pro.quizList||[];var sqList=[];var quiz,quizId,submit,submitQuizId,submitNode,submitNodeQuizId;for(var i=0;i<qList.length;i++){quiz=qList[i];quizId=quiz.quizId;submit=quiz.submit;if(typeof submit=="undefined"||typeof submit.quizId=="undefined"){sqList.push(quiz);continue}submitQuizId=submit.quizId;if(quizId!=submitQuizId){quiz.submit==null;sqList.push(quiz);continue}var attrNodeId,attrNodeName,attrNodeSize,attrNode,attrNodeState;var arr_nId,arr_nName,arr_nSize,arr_nState,attr_node;for(var j=0;j<submitNodeList.length;j++){submitNode=submitNodeList[j];if(typeof submitNode=="string"){submitNode=JSON.parse(submitNode)}submitNodeQuizId=submitNode.quizId;attrNode=[];if(typeof submitNodeQuizId!="undefined"){if(submitNodeQuizId==submitQuizId){attrNodeId=submitNode.attrNodeId||"";attrNodeName=submitNode.attrNodeName||"";attrNodeSize=submitNode.attrNodeSize||"";attrNodeState=submitNode.attrNodeState||"";arr_nId=[],arr_nName=[],arr_nSize=[];arr_nState=[];if(typeof attrNodeId!="undefined"&&$.trim(attrNodeId+"").length>0&&attrNodeId.indexOf(",")>=0){arr_nId=attrNodeId.split(",");arr_nId.length--;arr_nId.shift();if(typeof attrNodeName!="undefined"&&$.trim(attrNodeName+"").length>0&&attrNodeName.indexOf(",")>=0){arr_nName=attrNodeName.split(",");arr_nName.length--;arr_nName.shift()}if(typeof attrNodeSize!="undefined"&&$.trim(attrNodeSize+"").length>0&&attrNodeSize.indexOf(",")>=0){arr_nSize=attrNodeSize.split(",");arr_nSize.length--;arr_nSize.shift()}if(typeof attrNodeState!="undefined"&&$.trim(attrNodeState+"").length>0&&attrNodeState.indexOf(",")>=0){arr_nState=attrNodeState.split(",");arr_nState.length--;arr_nState.shift()}}for(var x=0;x<arr_nId.length;x++){attr_node={};attr_node.node_id=arr_nId[x];attr_node.node_name=arr_nName[x];attr_node.node_size=arr_nSize[x];attr_node.node_state=arr_nState[x]||0;attrNode.push(attr_node)}break}}else{gM.log("error setSubmit: undefined quiz find in  quizList",submit)}}submit.nodeAttr=attrNode;quiz.submit=submit;sqList.push(quiz)}pro.quizList=sqList;sqList=null,qList=null,quiz=null,quizId=null,submit=null,submitQuizId=null;pro._submitQuizNode=submitNodeList}return pub},setStandard:function(standardList){if(typeof standardList!="undefined"&&handler.isArray(standardList)){var qList=pro.quizList||[];var sqList=[];var quiz,quizId,standard;for(var i=0;i<qList.length;i++){quiz=qList[i];quizId=quiz.quizId;if(typeof quiz.standardAndRecord=="undefined"&&arrUtil.isArray(quiz.standardAndRecord)){quiz.standardAndRecord=handler.getStandard(standardList,quizId)}else{quiz.standardAndRecord=handler.mergeStandard(quiz.standardAndRecord,standardList,quizId)}sqList.push(quiz)}pro.quizList=sqList;sqList=null,qList=null,quiz=null,quizId=null,standard=null;pro._standard=standardList}return pub},setReview:function(reviewList){if(typeof reviewList!="undefined"&&handler.isArray(reviewList)){var qList=pro.quizList||[];var sqList=[];var quiz,quizId,review;for(var i=0;i<qList.length;i++){quiz=qList[i];quizId=quiz.quizId;review={};var attrNodeId,attrNodeName,attrNodeSize,attrNode,attrNodeState;var arr_nId,arr_nName,arr_nSize,attr_node;var _l=reviewList.length;attrNode=[];while(_l--){if(reviewList[_l]["quizId"]==quizId){review=reviewList[_l];if(typeof quiz.standardAndRecord=="undefined"&&arrUtil.isArray(quiz.standardAndRecord)){quiz.standardAndRecord=handler.getRecord(review.examReviewRecords,quizId)}else{quiz.standardAndRecord=handler.mergeRecord(quiz.standardAndRecord,review.examReviewRecords,quizId)}attrNodeId=review.attrNodeId||"";attrNodeName=review.attrNodeName||"";attrNodeSize=review.attrNodeSize||"";attrNodeState=JSON.parse(review.attrNodeState||"{}");arr_nId=[],arr_nName=[],arr_nSize=[];if(typeof attrNodeId!="undefined"&&$.trim(attrNodeId+"").length>0&&attrNodeId.indexOf(",")>=0){arr_nId=attrNodeId.split(",");arr_nId.length--;arr_nId.shift();if(typeof attrNodeName!="undefined"&&$.trim(attrNodeName+"").length>0&&attrNodeName.indexOf(",")>=0){arr_nName=attrNodeName.split(",");arr_nName.length--;arr_nName.shift()}if(typeof attrNodeSize!="undefined"&&$.trim(attrNodeSize+"").length>0&&attrNodeSize.indexOf(",")>=0){arr_nSize=attrNodeSize.split(",");arr_nSize.length--;arr_nSize.shift()}}for(var x=0;x<arr_nId.length;x++){attr_node={};attr_node.node_id=arr_nId[x];attr_node.node_name=arr_nName[x];attr_node.node_size=arr_nSize[x];attr_node.node_state=attrNodeState[arr_nId[x]]||0;attrNode.push(attr_node)}review.nodeAttr=attrNode;quiz.review=review;break}}sqList.push(quiz)}pro.quizList=sqList;sqList=null,qList=null,quiz=null,quizId=null;pro._review=reviewList}return pub},clearStandard:function(){var standardList=pro._standard;if(typeof standardList!="undefined"&&handler.isArray(standardList)){var qList=pro.quizList||[];var sqList=[];var quiz,quizId,standard;for(var i=0;i<qList.length;i++){quiz=qList[i];quizId=quiz.quizId;quiz.standardAndRecord=handler.getStandard(standardList,quizId);sqList.push(quiz)}pro.quizList=sqList;sqList=null,qList=null,quiz=null,quizId=null,standard=null;pro._standard=standardList}return pub},clearReview:function(){var qList=pro.quizList||[];var sqList=[];var quiz;for(var i=0;i<qList.length;i++){quiz=qList[i];quiz.review={nodeAttr:[]};sqList.push(quiz)}pro.quizList=sqList;sqList=null,qList=null,quiz=null;pro._review=[];pub.clearStandard();return pub},getPractice:function(){var userQuiz=[];var sel_options;var user_quiz;var quiz_id,baseType,quiz_score;var quiz;$("#"+targetId).find(".view-test").each(function(){user_quiz={};sel_options=[];quiz_id=$(this).attr("quiz_id");quiz_score=$(this).attr("quiz_score");baseType=$(this).attr("base_type");user_quiz.quizId=quiz_id;quiz=pub.getData("quizId",quiz_id)["quiz"];$(this).find(".t-option").each(function(){if($(this).find('[_type="practice"]').eq(0).hasClass("selected")){var oId=$(this).attr("option_id");sel_options.push(oId)}});if("itt002,itt003,itt004".indexOf(baseType)>-1){user_quiz.userAnswer=sel_options.join(",");user_quiz.errorFlag=handler.getUserAnswerResult(sel_options.join(","),quiz);user_quiz.markResult=user_quiz.errorFlag=="right"?1:0;user_quiz.markQuizScore=user_quiz.errorFlag=="right"?quiz_score:0}else{if($(this).find(".edui-body-container").length>0){var _userAnswer=UM.getEditor($(this).find(".edui-body-container").eq(0).attr("id")).getContent();_userAnswer=removeScript(_userAnswer);user_quiz.userAnswer=_userAnswer}}userQuiz.push(JSON.stringify(user_quiz))});return userQuiz},getCurrentQuizAnswer:function(flag){var userQuiz=[];var sel_options;var user_quiz;var quiz_id,baseType,quiz_score;var quiz;var $currentQuizView=$("#"+targetId).find(".view-test").filter(".current");var $currentQuiz=$currentQuizView.parent();user_quiz={};sel_options=[];quiz_id=$currentQuiz.attr("quiz_id");quiz_score=$currentQuiz.attr("quiz_score");baseType=$currentQuiz.attr("base_type");user_quiz.quizId=quiz_id;quiz=pub.getData("quizId",quiz_id)["quiz"];$currentQuiz.find(".t-option").each(function(){if($(this).hasClass("selected")){var oId=$(this).attr("option_id");sel_options.push(oId)}});if(sel_options.length==0){$.dialog.warn("请选择答案！");return false}if("itt002,itt003,itt004".indexOf(baseType)>-1){user_quiz.userAnswer=sel_options.join(",");user_quiz.errorFlag=handler.getUserAnswerResult(sel_options.join(","),quiz);user_quiz.markResult=user_quiz.errorFlag=="right"?1:0;user_quiz.markQuizScore=user_quiz.errorFlag=="right"?quiz_score:0;user_quiz.quizR=quiz.quizResponses[0]["optionId"]}else{if($(this).find(".edui-body-container").length>0){user_quiz.userAnswer=UM.getEditor($(this).find(".edui-body-container").eq(0).attr("id")).getContent()}}if(!flag){pro.allUserAnswers.push(JSON.stringify(user_quiz))}if("itt002,itt003,itt004".indexOf(baseType)>-1){if(quiz.quizSolutions[0]){user_quiz.solution=quiz.quizSolutions[0]["content"]}else{user_quiz.solution=""}}userQuiz.push(JSON.stringify(user_quiz));return userQuiz},getAllUserAnswers:function(){return pro.allUserAnswers},getPracticeNode:function(){var attr_nodes=[];$("#"+targetId).find(".view-test").each(function(){var attr_node={quizId:$(this).attr("quiz_id")};var _attr_node;$(this).find('[_type="practice_attr"] >.test-para').each(function(){_attr_node=$.extend({},attr_node);if($(this).attr("file_name")!="undefined"&&$(this).attr("file_name")!=""){_attr_node.nodeId=$(this).attr("_node_id");_attr_node.fileName=$(this).attr("file_name");_attr_node.fileSize=$(this).attr("file_size");_attr_node.relativePath=$(this).attr("relative_path");_attr_node.absolutePath=$(this).attr("absolute_path");_attr_node.fileTempPath=$(this).attr("temp_path");_attr_node.attrNodeId=$(this).attr("_node_id");_attr_node.attrNodeName=$(this).attr("file_name");_attr_node.attrNodeSize=$(this).attr("file_size");_attr_node.attrNodeState=0;attr_nodes.push(JSON.stringify(_attr_node))}})});return attr_nodes},getPracticeNodeNotSave:function(){var attr_nodes=[];$("#"+targetId).find(".view-test").each(function(){var attr_node={quizId:$(this).attr("quiz_id")};var _attr_node;$(this).find('[_type="practice_attr"] >.test-para').each(function(){_attr_node=$.extend({},attr_node);if($(this).attr("file_name")!="undefined"&&$(this).attr("file_name")!=""){_attr_node.nodeId="-1";_attr_node.fileName=$(this).attr("file_name");_attr_node.fileSize=$(this).attr("file_size");_attr_node.relativePath=$(this).attr("relative_path");_attr_node.absolutePath=$(this).attr("absolute_path");_attr_node.fileTempPath=$(this).attr("temp_path");_attr_node.attrNodeId="-1";_attr_node.attrNodeName=$(this).attr("file_name");_attr_node.attrNodeSize=$(this).attr("file_size");_attr_node.attrNodeState="0";attr_nodes.push(_attr_node)}})});return attr_nodes},autoReview:function(){var userAnswer=pub.getPractice();for(var i=0;i<userAnswer.length;i++){var quiz=JSON.parse(userAnswer[i]);var quizId=quiz.quizId;var errorFlag=quiz.errorFlag;$("#"+targetId).find('[_type="response"]').css({display:""});$("#"+targetId).find('[_type="solution"]').css({display:""});if(errorFlag!="right"){$("#"+targetId).find('[quiz_id="'+quizId+'"] [_type="error-mark"]').show();$("#"+targetId).find('[quiz_id="'+quizId+'"] [_type="right-mark"]').hide()}else{if(errorFlag!="error"){$("#"+targetId).find('[quiz_id="'+quizId+'"] [_type="error-mark"]').hide();$("#"+targetId).find('[quiz_id="'+quizId+'"] [_type="right-mark"]').show()}}if($("#"+targetId).find('[quiz_id="'+quizId+'"]').attr("error_flag")=="quizError"){$("#"+targetId).find('[quiz_id="'+quizId+'"] [_type="quizError-mark"]').show();$("#"+targetId).find('[quiz_id="'+quizId+'"] [_type="error-mark"]').hide()}}},autoReviewOneByOne:function(){var userAnswer=pub.getCurrentQuizAnswer(true);var t=JSON.parse(userAnswer[0]);if(t.userAnswer==null||t.userAnswer==""){return false}else{var solution="";for(var i=0;i<userAnswer.length;i++){var quiz=JSON.parse(userAnswer[i]);var quizId=quiz.quizId;solution=quiz.solution;var errorFlag=quiz.errorFlag;$("#"+targetId).find('[quiz_id="'+quizId+'"]').find(".option-order").removeClass("answer-right");$("#"+targetId).find('[quiz_id="'+quizId+'"]').find(".option-order").removeClass("answer-error");$("#"+targetId).find('[quiz_id="'+quizId+'"]').find(".t-option").each(function(){var $option=$(this);if(quiz.quizR==$option.attr("option_id")){$option.find(".option-order").addClass("answer-right")}else{if(quiz.userAnswer==$option.attr("option_id")){$option.find(".option-order").addClass("answer-error")}}})}if(solution!=""){$.ajax({url:CONTEXTPATH+"/node/checkNetFile.mooc",type:"post",async:false,timeout:1000,data:{fileUrl:solution},dataType:"html",success:function(JsonDate){if(JsonDate=="true"){var obj=$("#"+targetId).find('[quiz_id="'+quizId+'"]').find(".test-article");if(obj==null||obj.length==0){var fo=$("#"+targetId).find('[quiz_id="'+quizId+'"]').find(".view-test");fo.removeClass("not-article");obj=$('<div class="test-article" style="width:0px"></div>');obj.insertBefore($(".test-quiz",fo));obj.animate({width:"58%"},"slow")}else{obj.empty()}obj.append('<div id="video_solution"></div>');jwplayer("video_solution").setup({file:solution,width:475,height:390,dock:false,autostart:true})}},error:function(){}})}return true}},oneByOneNext:function(){var quizLength=$("#"+targetId).find(".view-test").length;if(quizLength>1){var curr=$("#"+targetId).find('div[id^="exam_paper_"]')[0];var $curr=$(curr);$curr.next().find(".view-test").addClass("current");$curr.remove();return true}else{$.dialog.warn("已经是最后一题！");return false}},getReviewResult:function(){var reviewResult=[];var reviewObj;var record;var recordObj;$("#"+targetId).find(".view-test").each(function(){reviewObj={};var $this=$(this);reviewObj.submitId=$this.attr("submit_id");reviewObj.quizId=$this.attr("quiz_id");reviewObj.reviewId=$this.attr("review_id");if($(this).find(".edui-body-container").length>0){var _reviewNotes=UM.getEditor($(this).find(".edui-body-container").eq(0).attr("id")).getContent();_reviewNotes=removeScript(_reviewNotes);reviewObj.reviewNotes=_reviewNotes}reviewObj.reviewScore=$this.find("#reviewScore_"+reviewObj.reviewId).val();reviewObj.exceptionFlag=0;$(this).find(".input-c_exception").each(function(){var $checkbox=$(this);if($checkbox.hasClass("selected")){reviewObj.exceptionFlag=reviewObj.exceptionFlag+parseInt($checkbox.attr("_exceptionVal"))}});record=[];$(this).find("[id^='quiz_standard_']").each(function(){recordObj={};var $this=$(this);recordObj.recordId=$this.attr("record_id");recordObj.standardId=$this.attr("standard_id");recordObj.reviewRecordScore=$this.val();record.push(recordObj)});reviewObj.examReviewRecords=record;reviewResult.push(JSON.stringify(reviewObj))});return reviewResult},getReviewNode:function(){var attr_nodes=[];$("#"+targetId).find(".view-test").each(function(){var attr_node={quizId:$(this).attr("quiz_id")};var _attr_node;$(this).find('[_type="comment_attr"] >.test-para').each(function(){_attr_node=$.extend({},attr_node);if($(this).attr("file_name")!="undefined"&&$(this).attr("file_name")!=""){_attr_node.nodeId=$(this).attr("_node_id");_attr_node.fileName=$(this).attr("file_name");_attr_node.fileSize=$(this).attr("file_size");_attr_node.relativePath=$(this).attr("relative_path");_attr_node.absolutePath=$(this).attr("absolute_path");_attr_node.fileTempPath=$(this).attr("temp_path");attr_nodes.push(JSON.stringify(_attr_node))}})});return attr_nodes}};var config=$.extend({},defArg,args);if(config.practice=="false"){config.practice=false}if(config.icon||config.autoReview){if(!$Div.hasClass("view-test-prev")){$Div.addClass("view-test-prev")}}if(config.toggleTitle){if(!$Div.hasClass("view-test-toggle")){$Div.addClass("view-test-toggle")}}if(config.standard){$("#"+targetId).on("click",".btn_add_option",element.addStandardOption);$("#"+targetId).on("click",".del_option",element.deleteStandardOption)}if(config.practice){$("#"+targetId).on("click",".q-mark",quizMark);$("#"+targetId).on("click",".test-options .input-r",element.r_input_click);$("#"+targetId).on("click",".test-options .input-c",element.c_input_click);$("#"+targetId).on("click",'[_type="del_user_ana_attr"]',element.del_user_ana_attr)}if(config.showOneByOne){$("#"+targetId).on("click",".test-options .option-text",element.c_input_click)}$("#"+targetId).on("click",'[_type="toggleTitle"]',element.toggleTitle);if(config.reviewModel){$("#"+targetId).on("click",'[_type="del_user_ana_attr"]',element.del_user_ana_attr);$("#"+targetId).on("click",".input-c_exception",element.exception_input_click)}if(config.libEdit){$("#"+targetId).on("click",'[_type="delLib"]',element.delLib)}$Div.data("quizFactory","complete");return pub};$.quizFactory=$.quizFactory||{};$.fn.quiz=function(args){var $Target=$(this);var $TargetId=$Target.attr("id");if(typeof $TargetId=="undefined"){$TargetId=gM.getRID("quiz_factory");$Target.attr("id",$TargetId)}if($Target.data("quizFactory")!=="complete"){if(typeof $.quizFactory[$TargetId]!="undefined"){$.quizFactory[$TargetId].destroy()}$.quizFactory[$TargetId]=null}if(typeof $.quizFactory[$TargetId]=="undefined"||$.quizFactory[$TargetId]==null){$.quizFactory[$TargetId]=new quizFactory($TargetId,args)}else{$.quizFactory[$TargetId].setConfig(args)}return $.quizFactory[$TargetId]}})($||jQuery);function buildQuizType(param){var def={target:"#type_tab",typeList:[],selected:""};var p=$.extend(def,param);$(p.target).empty();$(p.target).html(quizTypeHtml(p.typeList,p.selected));p.success&&p.success()}function quizTypeHtml(types,typed){var All={};All.quizNum=0;All.quizTypeId="";All.quizTypeName="全部";for(var i=0;i<types.length;i++){var type=types[i];if(typeof type!="undefined"&&typeof type.quizNum!="undefined"){All.quizNum+=type.quizNum}}return template("view_type",{list:types,selected:typed,all:All})}function activeTab(obj){var $tab=obj.parent();$tab.siblings(".tab-active").removeClass("tab-active");$tab.addClass("tab-active")}function quizMark(){if($(this).hasClass("marked")){$(this).removeClass("marked");var _index=$(this).parents(".practice-item").index();$($(".p-no").get(_index)).removeClass("marked")}else{$(this).addClass("marked");var _index=$(this).parents(".practice-item").index();$($(".p-no").get(_index)).addClass("marked")}};(function(){template.compile('<div class="dialog" id="pathEdit"> <div class="ui-dialog-public ui-set-direction scroll-pane"> <p class="public-tip"><i class="icon-tip"></i>\u521b\u5efa\u7f16\u8f91\u76ee\u5f55\u3001\u4e3a\u9898\u76ee\u8bbe\u7f6e\u6240\u5728\u76ee\u5f55</p> <ul id="tree-points" class="ztree"></ul> </div> </div>',{filename:"path_dialog"});template.compile('<div class="dialog"> <form id="lib_form" onsubmit="return false"> <div class="ui-forum"> <div class="input-group" id="tips_forum_2"> <label class="input-label"><b>*</b> \u76ee\u5f55\u540d\u79f0 </label> <input _node_id="/*=libId*/" class="input-text validate[required,funcCallRequired[checkSpecialCharacters],maxSize[30]]" coustom_target="cccc" type="text" id="builder_libName" value="/*=libName*/"> </div> <i id="cccc"></i> </div> </form> </div>',{filename:"builder_path_template"});template.compile('<div class="dk-selected">\u6839\u76ee\u5f55</div> <div class="points-auto-box"> <ul class="point-tree"> /* for(var i=0;i< nodeList.length;i++){ var node=nodeList[i]; var index=0; include(\'path_template_ul_view\',{node:node,index:index}); } */ </ul> </div>',{filename:"path_template_view"});template.compile('/* var nodeList=node[\'childrenNode\']||[]; var cL=nodeList.length; */ <li _id="/*=node[\'id\']*/"> <div class="point-node"> /* for(var i=0;i< index;i++){ */ <i class="icon-indent"></i> /* } if(cL>0){ */ <i class="icon-hit icon-plus"></i> /* }else{ */ <i class="icon-indent"></i> /* } */ <span class="point-title">/*=node[\'name\']*/</span> </div> <ul class="point-tree"> /* index++; for(var i=0;i< nodeList.length;i++){ var node=nodeList[i]; include(\'path_template_ul_view\',{node:node,index:index}); } */ </ul> </li>',{filename:"path_template_ul_view"})})();(function($){function pathFactory(targetId,args){var _t="#"+targetId;var $Div=$(_t);$Div.data("nodePath","complete");var pro={nodeList:null,nodes:[]};var defArg={idFormat:"{targetId}_{quizId}",id:"nodeId",pId:"parentId",name:"nodeName",clickCallBack:null};var layout=function(){gM.log(pro.nodes);var _layout=$(template("path_template_view",{nodeList:pro.nodes,config:config}));$Div.html(_layout)};var element={addPoint:function($node){var text=$node.find(".point-title").text();$node.parents(".tree-select").find(".dk-selected").text(text);$node.parents(".tree-select").find(".points-auto-box").slideUp(150);var array=[];array.push(text);$node.parents("ul").each(function(){var $supNode=$(this).prev(".point-node");if($supNode.length!=0){array.push($supNode.find(".point-title").text()+" &gt; ")}});element.setQuizDirection(array.reverse().join(""));var _id="";var node={};if($node.closest("li")){_id=$node.closest("li").attr("_id")||"";node=pro._id_data[_id]||{}}config.clickCallBack&&config.clickCallBack(_id,node)},setQuizDirection:function(casecadeText){$(".view-test-prev").find(".view-test").each(function(){var $option=$(this).find(".prev-option");var selected=$option.find(".input-c").hasClass("selected");if(selected){$option.parents(".view-test").find(".directory-text").html(casecadeText)}})},toggleNode:function($node){if($node.hasClass("expanded-node")){element.collapsedNode($node)}else{element.expandedNode($node)}},expandedNode:function($node){$node.removeClass("collapsed-node").addClass("expanded-node");$node.find(".icon-plus").removeClass("icon-plus").addClass("icon-minus");$node.next().slideDown(150)},collapsedNode:function($node){$node.removeClass("expanded-node").addClass("collapsed-node");$node.find(".icon-minus").removeClass("icon-minus").addClass("icon-plus");$node.next().slideUp(150)}};var handler={isArray:function(obj){return arrUtil.isArray(obj)},convert:function(){if(!handler.isArray(pro.nodeList)){pro.nodeList=[]}var nodeList=pro.nodeList;var _id_data={};var _pid_data={};var _root=[];var _sub=[];var node;for(var i=0;i<nodeList.length;i++){node=nodeList[i];var id=node.id;var pId=node.pId;if(pId==id){pId=gM.getRID()}_id_data[id]=node;if(typeof _pid_data[pId]=="undefined"){_pid_data[pId]={}}_pid_data[pId][id]=node;_sub.push(id);_root.push(pId)}var _rL=_root.length;while(_rL--){var _sL=_sub.length;var _i=_rL;if(typeof _root[_rL]!="undefined"){while(_i>0){_i--;if(typeof _sub[_i]!="undefined"&&_root[_rL]==_root[_i]){delete _root[_rL];break}}if(typeof _root[_rL]!="undefined"){while(_sL>0){_sL--;if(typeof _sub[_sL]!="undefined"&&_root[_rL]==_sub[_sL]){delete _root[_rL];delete _sub[_rL];break}}}}}pro._id_data=_id_data;var _data=[];_rL=_root.length;while(_rL--){if(typeof _root[_rL]!="undefined"){var rId=_root[_rL];node=_id_data[rId]||{id:rId};node.childrenNode=handler.getSub(rId,_pid_data);_data.push(node)}}pro.nodes=handler.getRootNode(_data)},getSub:function(id,pid_id){var _r=[];var _p_i=pid_id[id]||{};var node;for(var _id in _p_i){node=_p_i[_id];node.childrenNode=handler.getSub(_id,pid_id);_r.push(node)}return _r},getRootNode:function(_data){if(!handler.isArray(_data)){_data=[]}var root=[];for(var i=0;i<_data.length;i++){var _n=_data[i];if(typeof _n.nodeData!="undefined"){root.push(_n)}else{if(typeof _n.childrenNode!="undefined"){root=root.concat(handler.getRootNode(_n.childrenNode))}}}return root}};var pub={destroy:function(){},setConfig:function(args){config=$.extend({},config,args);return pub},builder:function(){layout();return pub},setNodes:function(nodeList){var _c=[];var node;if(handler.isArray(nodeList)){for(var i=0;i<nodeList.length;i++){node=nodeList[i];_c.push({id:node[config.id],name:node[config.name],pId:node[config.pId],nodeData:node})}}pro.nodeList=_c;handler.convert();return pub}};var config=$.extend({},defArg,args);$Div.on("click",".icon-hit",function(event){var $node=$(this).parent(".point-node");event.stopPropagation();element.toggleNode($node)});$Div.on("click",".point-node",function(event){var $node=$(this);event.stopPropagation();$node.parents(".point-tree").find(".point-node.current").removeClass("current");$node.addClass("current");element.addPoint($node)});$Div.on("click",function(event){$Div.find(".points-auto-box").slideDown(150);event.stopPropagation()});if(!$Div.hasClass("dk-select")){$Div.addClass("dk-select")}if(!$Div.hasClass("tree-select")){$Div.addClass("tree-select")}$Div.data("nodePath","complete");return pub}$.nodePath=$.nodePath||{};$.fn.nodePath=function(args){var $Target=$(this);var $TargetId=$Target.attr("id");if(typeof $TargetId=="undefined"){$TargetId=gM.getRID("quiz_factory");$Target.attr("id",$TargetId)}if($Target.data("nodePath")!=="complete"){if(typeof $.nodePath[$TargetId]!="undefined"){$.nodePath[$TargetId].destroy()}$.nodePath[$TargetId]=null}if(typeof $.nodePath[$TargetId]=="undefined"||$.nodePath[$TargetId]==null){$.nodePath[$TargetId]=new pathFactory($TargetId,args)}else{$.nodePath[$TargetId].setConfig(args)}return $.nodePath[$TargetId]}})($||jQuery);var libCheckBox=libCheckBox||{};var zTreeObj=zTreeObj||{};function setLib(libId){var type=$("#type").val();var listIds=[];var checkObj=libCheckBox.getCheckedObj();for(var i=0;i<checkObj.length;i++){if(type=="quiz"){if(typeof $(checkObj[i])!="undefined"&&typeof $(checkObj[i]).attr("check_quiz_id")!="undefined"){listIds.push($(checkObj[i]).attr("check_quiz_id"))}}else{if(typeof $(checkObj[i])!="undefined"&&typeof $(checkObj[i]).attr("check_node_id")!="undefined"){listIds.push($(checkObj[i]).attr("check_node_id"))}}}$.ajax({url:CONTEXTPATH+"/lib/"+libId+".mooc",data:{},dateType:"json",type:"post",success:function(JsonData){if(JsonData.status==1){var subLibList=JsonData.subLibList;var libNodes=JsonData.libNodes;intiDialog(libNodes,subLibList,listIds.length>0)}}})}function intiDialog(libNodes,subLibList,showChange){var type=$("#type").val();var $pathDialog=$(template("path_dialog",{}));$("#dialog_home").append($pathDialog);var okVal="确定";var ok=function(){VRF.reload()};var cancelVal="关闭";var cancel=function(){setTimeout(function(){$pathDialog.remove()},500);pathDialogClose&&pathDialogClose()};var dg;if(showChange){ok=function(){var selectNode=zTreeObj.getSelectedNodes()[0]||{};if(typeof selectNode.id=="undefined"||typeof selectNode.name=="undefined"){$.dialog.warn("请选择相应的目录，设置为资源的转移目录！");return false}$.confirm("确定将资源移动到："+selectNode.name+"?",function(){var listIds=[];var checkObj=libCheckBox.getCheckedObj();for(var i=0;i<checkObj.length;i++){if(type=="quiz"){if(typeof $(checkObj[i])!="undefined"&&typeof $(checkObj[i]).attr("check_quiz_id")!="undefined"){listIds.push($(checkObj[i]).attr("check_quiz_id"))}}else{if(typeof $(checkObj[i])!="undefined"&&typeof $(checkObj[i]).attr("check_node_id")!="undefined"){listIds.push($(checkObj[i]).attr("check_node_id"))}}}if(type=="quiz"){$.ajax({url:CONTEXTPATH+"/lib/move/quiz/"+selectNode.id+".mooc",type:"post",data:{quizId:listIds},async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));dg&&dg.close();setNodeLibCallBack&&setNodeLibCallBack()}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})}else{$.ajax({url:CONTEXTPATH+"/lib/move/"+selectNode.id+".mooc",type:"post",data:{nodeId:listIds},async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));dg&&dg.close();setNodeLibCallBack&&setNodeLibCallBack()}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})}},function(){});return false}}dg=$.dialog({title:"设置目录",content:$pathDialog.get(0),width:"680px",lock:true,cancelValue:cancelVal,okValue:okVal,initialize:function(){initTree(libNodes,subLibList);updateScrollPane()},ok:ok,cancel:cancel})}function updateScrollPane(){$(".scroll-pane").jScrollPane({autoReinitialise:true})}function initTree(libNodes,subLibList){var setting={data:{simpleData:{enable:true}},edit:{enable:true,showRemoveBtn:false,showRenameBtn:false},view:{addHoverDom:addHoverDom,removeHoverDom:removeHoverDom,showLine:false,dblClickExpand:true,showIcon:false},callback:{beforeDrop:function(){return false},beforeDrag:function(){return false},beforeCollapse:beforeCollapse,onExpand:updateScrollPane,onCollapse:updateScrollPane,onDblClick:false}};if(!arrUtil.isArray(subLibList)){subLibList=[]}var zNodes=[];var open=false;for(var i=0;i<subLibList.length;i++){open=false;var sub=subLibList[i];if(subLibList.length<9&&(parseInt(sub.levelNum)-parseInt(libNodes.levelNum)==1)){open=true}zNodes.push({id:sub.nodeId,pId:sub.parentId,name:sub.nodeName,open:open,nodeData:sub})}zNodes.push({id:libNodes.nodeId,pId:libNodes.parentId,name:"根目录",open:true,nodeData:libNodes});function beforeCollapse(treeId,treeNode){return(treeNode.collapse!==false)}function addHoverDom(treeId,treeNode){var type=$("#type").val();var sObj=$("#"+treeNode.tId+"_span");var dg;if(treeNode.editNameFlag||$("#editBtn_"+treeNode.id).length>0||$("#addBtn_"+treeNode.id).length>0){return}if(treeNode.level>0){var removeBtn=$("<span class='button remove' id='removeBtn_"+treeNode.id+"' title='删除'></span>");sObj.after(removeBtn);removeBtn.data("treeNode",treeNode);removeBtn.on("click.tree_removeBtn_",function(){var $this=$(this);var treeNode=$this.data("treeNode");$.dialog.confirm("删除目录，会同时删除子目录。目录下所有资源都会转移到根目录。确定要删除么？",function(){if(type=="quiz"){$.ajax({url:CONTEXTPATH+"/lib/del/quiz/"+treeNode.id+".mooc",type:"post",async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));zTreeObj.removeNode(treeNode);setNodeLibCallBack&&setNodeLibCallBack()}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})}else{$.ajax({url:CONTEXTPATH+"/lib/del/"+treeNode.id+".mooc",type:"post",async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));zTreeObj.removeNode(treeNode);setNodeLibCallBack&&setNodeLibCallBack()}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})}},function(){})})}if(treeNode.level!=0){var editBtn=$("<span class='button edit' id='editBtn_"+treeNode.id+"' title='编辑'></span>");sObj.after(editBtn);editBtn.data("treeNode",treeNode);editBtn.on("click.tree_editBtn_",function(){var $this=$(this);var treeNode=$this.data("treeNode");var name=treeNode.name;var id=treeNode.id;var parentId=treeNode.pId;var $htmlStr=$(template("builder_path_template",{libName:name,libId:id}));$.dialog({title:"编辑目录",content:$htmlStr[0],width:"680px",lock:true,ok:function(){var libName=$("#lib_form").find("#builder_libName").val();var libId=$("#lib_form").find("#builder_libName").attr("_node_id");var validate=$("#lib_form").validationEngine("validate");if(!validate){return false}if(!checkLib(parentId,libName,libId)){$.dialog.warn("该目录下已存在同名的目录");return false}$.ajax({url:CONTEXTPATH+"/lib/edit/"+treeNode.id+".mooc",data:{libName:libName},type:"post",async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){$.dialog.success(Msg.get("submit.success"));treeNode.name=libName;zTreeObj.updateNode(treeNode)}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})},cancel:true});$("#lib_form").validationEngine()})}if(treeNode.level<3){var addBtn=$("<span class='button add' id='addBtn_"+treeNode.id+"' title='新建'></span>");sObj.after(addBtn);addBtn.data("treeNode",treeNode);addBtn.on("click.tree_addBtn_",function(){var $this=$(this);var treeNode=$this.data("treeNode");var $htmlStr=$(template("builder_path_template",{}));$.dialog({title:"新建目录",content:$htmlStr[0],width:"680px",lock:true,ok:function(){var libName=$("#lib_form").find("#builder_libName").val();var validate=$("#lib_form").validationEngine("validate");if(!validate){return false}if(!checkLib(treeNode.id,libName)){$.dialog.warn("该目录下已存在同名的目录");return false}$.ajax({url:CONTEXTPATH+"/lib/"+treeNode.id+"/add.mooc",data:{libName:libName},type:"post",async:false,dataType:"json",success:function(JsonDate){if(JsonDate.status==1){var rsNodes=JsonDate.rsNodes;$.dialog.success(Msg.get("submit.success"));zTreeObj.addNodes(treeNode,{id:rsNodes.nodeId,pId:treeNode.id,name:rsNodes.nodeName,nodeData:{nodeData:rsNodes}})}else{$.dialog.success(Msg.get("submit.false"))}},error:function(){}})},cancel:true});$("#lib_form").validationEngine()})}}function removeHoverDom(treeId,treeNode){$("#addBtn_"+treeNode.id).remove();$("#removeBtn_"+treeNode.id).remove();$("#editBtn_"+treeNode.id).remove();$("#link_"+treeNode.id).remove()}$.fn.zTree.init($("#tree-points"),setting,zNodes);zTreeObj=$.fn.zTree.getZTreeObj("tree-points");var rootNode=zTreeObj.getNodesByFilter(function(node){return node.level==0},true);zTreeObj.selectNode(rootNode,false)}function checkLib(pLibId,libName,libId){var _r=false;$.ajax({url:CONTEXTPATH+"/lib/valida/"+pLibId+".mooc",data:{libName:libName,libId:libId},method:"post",async:false,success:function(JsonData){if(JsonData.status==1){if(JsonData.libNum==0){_r=true}}}});return _r};(function($){var heartFactory=function(targetId,args){var _t="#"+targetId;var $Div=$(_t);var pro={InterValObj:null,userTime:0,lastExecTime:0};var defArg={timeout:1,execTime:10*60,heartExec:null,execWaitingOut:10};var element={};var handler={SetRemainTime:function(){if($("#"+targetId).length==0||typeof $("#"+targetId).data("heartFactory_UNQ")=="undefined"){pub.heartStop();return}pro.userTime=pro.userTime+1;if($Div.data("heartExec")=="free"){$Div.data("heartExec","exec");if(pro.userTime-pro.lastExecTime>config.execTime){if(typeof config.heartExec=="function"&&config.heartExec()){pro.lastExecTime=pro.userTime;$Div.data("heartExec","free")}}else{$Div.data("heartExec","free")}}else{if(pro.userTime-pro.lastExecTime>config.execTime+config.execWaitingOut){$Div.data("heartExec","free")}}}};var pub={setConfig:function(){config=$.extend({},config,args);return pub},heartStart:function(){$Div.data("heartExec","free");if(pro.InterValObj){window.clearInterval(pro.InterValObj);pro.InterValObj=null}pro.InterValObj=window.setInterval(handler.SetRemainTime,1000)},heartRestart:function(){$Div.data("heartExec","free");if(pro.InterValObj){window.clearInterval(pro.InterValObj);pro.InterValObj=null}pro.userTime=0;pro.InterValObj=window.setInterval(handler.SetRemainTime,1000)},heartStop:function(){$Div.data("heartExec","free");if(pro.InterValObj){window.clearInterval(pro.InterValObj);pro.InterValObj=null}},destroy:function(){pub.heartStop()},getUseTime:function(){return pro.userTime}};var config=$.extend({},defArg,args);$Div.data("heartFactory","complete");$Div.data("heartFactory_UNQ",gM.getRID());return pub};$.heartFactory=$.heartFactory||{};$.fn.heartFactory=function(args){var $Target=$(this);var $TargetId=$Target.attr("id");if(typeof $TargetId=="undefined"){$TargetId=gM.getRID("heart_factory");$Target.attr("id",$TargetId)}if($Target.data("heartFactory")!=="complete"){if(typeof $.heartFactory[$TargetId]!="undefined"){$.heartFactory[$TargetId].destroy()}$.heartFactory[$TargetId]=null}if(typeof $.heartFactory[$TargetId]=="undefined"||$.heartFactory[$TargetId]==null){$.heartFactory[$TargetId]=new heartFactory($TargetId,args)}else{$.heartFactory[$TargetId].setConfig(args)}return $.heartFactory[$TargetId]}})($||jQuery);var certTimeOut=certTimeOut||[];function previewTemplate(){var html=[];html.push("");html.push('<div class="fancy-content" style="overflow: visible">');html.push('<i class="icon-close"></i>');html.push('<div class="cert-model" style="background:#fff">');html.push('<div class="d-content" style="padding: 0px 0px;margin: 250px auto 0 auto;width:25px;display: block;"><div class="artDialog-tip" style="padding: 0 1em;"><i class="icon-loading"></i></div></div>');html.push("</div>");html.push("</div>");html.push("");return html.join("")}function previewCert(option){var def={courseOpenId:"",certInfoId:"",certUserRpId:"",applyUserId:""};var config=$.extend({},def,option);$.ajax({url:CONTEXTPATH+"/cert/previewImage.mooc",data:config,dataType:"json",success:function(JsonData){previewCertOpen(JsonData.previewUrl,JsonData.check)}})}function previewCertOpen(previewUrl,check){function view(){$(".cert-model .d-content").remove();$(".cert-model").empty();$(".cert-model").html('<img style="width: 100%;height: 100%" src="'+CONTEXTPATH+previewUrl+'">');setTimeout(resize,1000)}$("body >.fancy-wrap").remove();$("body >.fancy-content").remove();var $html=previewTemplate();$("body").append('<div class="fancy-wrap"></div>').append($html);$(".fancy-wrap","body").show(0);$(".fancy-content","body").animate({opacity:1,zIndex:1003},100,function(){$(".fancy-content .icon-close","body").show(0)});function resize(){var $img=$(".fancy-content .cert-model");if($img.length==0){return}function getH(w){return w*21/29.7}function getW(h){return h*29.7/21}if($(window).width()/$(window).height()<29.7/21){$(".fancy-content .cert-model").css({width:$(window).width(),height:getH($(window).width())})}else{$(".fancy-content .cert-model").css({width:getW($(window).height()),height:$(window).height()})}position()}function position(){if($(".fancy-content .cert-model").length==0){return}$(".fancy-content .cert-model,.fancy-content").position({of:$(window),my:"center center",at:"center center",collision:"flip flip "});if($(".fancy-content .icon-close").length==0){return}$(".fancy-content .icon-close").position({of:$(".fancy-content .cert-model"),my:"right bottom+24",at:"right top",collision:"flip flip "})}$(window).on("resize.cert-model",resize);$(window).on("scroll.cert-model",position);$(".fancy-wrap,.fancy-content .icon-close","body").on("click",function(){$("body >.fancy-wrap").remove();$("body >.fancy-content").remove();for(var i in certTimeOut){clearInterval(certTimeOut[i])}});if(check=="1"){var timout=setInterval(function(){$.ajax({url:CONTEXTPATH+"/cert/checkfile.mooc",type:"post",data:{fileUrl:previewUrl},dataType:"text",success:function(x){if(x=="exists"){for(var i in certTimeOut){view();clearInterval(certTimeOut[i])}}}})},500);certTimeOut.push(timout)}else{view()}};